<!DOCTYPE html>
<html class="h-full">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1315&amp;path=livereload" data-no-instant defer></script>
    <title>Websocket Glue for Data Streaming Apps</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet"><script defer src="/js/alpine_3_11_1.js"></script>

  <meta property="og:type" content="article" />
  <meta property="og:title" content="Websocket Glue for Data Streaming Apps" />
  <meta property="og:description" content="Create session-aware websocket glue that can be utilized by data streaming applications." />
  <meta property="og:image" content="http://localhost:1315/blog/images/websocket-glue/social/ws-glue.jpg">
  <meta name="twitter:site" content="@InfinyOn">
  <meta name="twitter:image:src" content="http://localhost:1315/blog/images/websocket-glue/social/ws-glue.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  </head>
  <body>
    
<div class="relative isolate flex items-center gap-x-6 overflow-hidden bg--100 py-2.5 px-6 sm:px-3.5 sm:before:flex-1 bg-indigo-300">
  <div class="flex flex-auto items-center gap-y-2 gap-x-4">
    <p class="text-sm leading-6 text-gray-900">
      <strong class="font-semibold">Stateful Services (private release)</strong>
      <svg viewBox="0 0 2 2" class="mx-2 inline h-0.5 w-0.5 fill-current" aria-hidden="true"><circle cx="1" cy="1" r="1" /></svg>
      Build composable event-driven data pipelines in minutes.
    </p>
    <a href="/request/ss-early-access" class="flex-none rounded-full bg-gray-900 py-1 px-3.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-900">
      Request access <span aria-hidden="true">&rarr;</span>
    </a>
  </div>
</div><div id="content">
      <header id="header" class="sticky top-0 z-20">
        <div 
  x-data="{ isOpen: false, menuOpen: '', showBorder: false }"
  @scroll.window="showBorder = (document.querySelector('#header').getBoundingClientRect().top <= 0 && window.pageYOffset > 2 ) ? true : false"
  :class="{ 'border-b border-gray-700' : showBorder}"
>
  <div class="bg-magenta-900 pt-4 pb-4">
    <nav class="relative mx-auto flex max-w-7xl items-center justify-between px-6" aria-label="Global">
      <div class="flex flex-1 items-center">
        <div class="flex w-full items-center justify-between md:w-auto">
          <a href="/">
            <span class="sr-only">InfinyOn</span>
            <img class="h-6 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
          </a>

          <div class="-mr-2 flex items-center md:hidden">
            <button 
              @click="isOpen = !isOpen" 
              type="button" 
              class="focus-ring-inset inline-flex items-center justify-center rounded-md bg-magenta-900 p-2 text-gray-400 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-white" aria-expanded="false"
              >
              <span class="sr-only">Open main menu</span>
              
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.4" stroke="white" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
              </svg>
            </button>                  
          </div>
        </div>

        <div class="hidden space-x-8 md:ml-10 md:flex">
              
            <div x-data="{ showDropdown: false }">
  <button 
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    @click="showDropdown = !showDropdown"
    type="button" 
    :class="{ 'text-gray-900' : showDropdown }"
    class="group inline-flex items-center rounded-md text-base text-white hover:text-gray-300" aria-expanded="false">
    <span>Use Cases</span>
    <svg 
      :class="{ 'rotate-90 text-gray-300' : showDropdown }"
      class="ml-2 h-4 w-4 text-white group-hover:text-gray-300"
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
    </svg>
  </button>

  <div
    x-cloak
    x-show="showDropdown"
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    class="absolute z-10 pt-3 transform shadow-lg"
  >

    <div class="overflow-hidden rounded-md shadow-md ring-1 ring-black ring-opacity-5">
        <div class="relative px-8 py-7 bg-slate-50" aria-labelledby="solutions-heading">
          <ul role="list" class="space-y-5">
              <li class="flow-root">
                <a href="/clickstream" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zm-7.518-.267A8.25 8.25 0 1120.25 10.5M8.288 14.212A5.25 5.25 0 1117.25 10.5" />
</svg><span class="ml-4">Clickstream Analytics</span>
                </a>
              </li>
              <li class="flow-root">
                <a href="/iot" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.348 14.651a3.75 3.75 0 010-5.303m5.304 0a3.75 3.75 0 010 5.303m-7.425 2.122a6.75 6.75 0 010-9.546m9.546 0a6.75 6.75 0 010 9.546M5.106 18.894c-3.808-3.808-3.808-9.98 0-13.789m13.788 0c3.808 3.808 3.808 9.981 0 13.79M12 12h.008v.007H12V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
</svg><span class="ml-4">IoT Mirroring</span>
                </a>
              </li>
              <li class="flow-root">
                <a href="/stateful-streaming" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
</svg>
<span class="ml-4">Stateful Streaming</span>
                </a>
              </li>
          </ul>
        </div>
    </div>
  </div>
  
</div>    
            
<a href="/docs" class="text-base text-white hover:text-gray-300 " class="">Docs</a>    
            
<a href="/blog" class="text-base text-white hover:text-gray-300  underline underline-offset-8 decoration-1" class="">Blog</a>    
            <div x-data="{ showDropdown: false }">
  <button 
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    @click="showDropdown = !showDropdown"
    type="button" 
    :class="{ 'text-gray-900' : showDropdown }"
    class="group inline-flex items-center rounded-md text-base text-white hover:text-gray-300" aria-expanded="false">
    <span>Resources</span>
    <svg 
      :class="{ 'rotate-90 text-gray-300' : showDropdown }"
      class="ml-2 h-4 w-4 text-white group-hover:text-gray-300"
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
    </svg>
  </button>

  <div
    x-cloak
    x-show="showDropdown"
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    class="absolute z-10 pt-3 transform shadow-lg"
  >

    <div class="overflow-hidden rounded-md shadow-md ring-1 ring-black ring-opacity-5">
        <div class="relative px-16 py-8 grid grid-cols-2 gap-24 bg-slate-50" aria-labelledby="solutions-heading">

          <div>
            <h3 class="text-md text-gray-700">Company</h3>
            <ul role="list" class="mt-4 space-y-6">
                <li class="flow-root">
                  <a href="/about" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
</svg><span class="ml-4">About</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/careers" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0M12 12.75h.008v.008H12v-.008z" />
</svg><span class="ml-4">Careers</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/press-releases" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
</svg><span class="ml-4">Press</span>
                  </a>
                </li>

            </ul>
          </div>

          <div>
            <h3 class="text-md text-gray-700">Resources</h3>
            <ul role="list" class="mt-4 space-y-6">
                <li class="flow-root">
                  <a href="/resources" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9" />
</svg><span class="ml-4">Articles</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/webinars" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
</svg><span class="ml-4">Webinars</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="https://www.youtube.com/@infinyon/videos" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z" />
</svg><span class="ml-4">Videos</span>
                  </a>
                </li>

            </ul>
          </div>
        </div>
  
    </div>
  </div>
  
</div>    
                
            </div>

      </div>
      
      <div class="hidden md:flex md:items-center md:space-x-6">
            
          
        <a href="https://infinyon.cloud?utm_campaign=global%20cloud%20link&amp;utm_source=website&amp;utm_medium=global%20button&amp;utm_term=infinyon%20cloud&amp;utm_content=cloud-registration" class="inline-flex items-center rounded-md px-4 py-1.5 text-sm font-semibold text-white bg-indigo-500 hover:bg-indigo-600">Cloud Login</a>
      </div>
    </nav>
  </div>

  <div class="absolute inset-x-0 top-0 px-2 origin-top transform transition md:hidden">
  <div x-show="isOpen" x-cloak x-transition:enter="duration-150 ease-out" x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100" x-transition:leave="duration-100 ease-in"
    x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
    class="overflow-hidden rounded-lg bg-slate-50 shadow-lg ring-1 ring-black ring-opacity-5">

    <div class="flex items-center justify-between px-5 pt-4 pb-2 bg-magenta-900">
      <div>
        <a href="/">
          <span class="sr-only">InfinyOn</span>
          <img class="h-6 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
        </a>
      </div>
      <div class="-mr-2">
        <button type="button" @click="isOpen = !isOpen"
          class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-600">
          <span class="sr-only">Close menu</span>
          
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <div class="pt-5 pb-6 max-h-screen -mb-16 overflow-y-auto">
      <div class="mb-16 space-y-1 px-2">
            
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Use Cases</p>
                
                <div class="ml-5">
                  
                    <a href="/clickstream"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Clickstream Analytics</a>
                  
                    <a href="/iot"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">IoT Mirroring</a>
                  
                    <a href="/stateful-streaming"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Stateful Streaming</a>
                  </div>
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Documentation</p> 
              <a href="/docs"
                class="block rounded-md ml-5 px-3 py-2 text-blue-700 hover:bg-gray-50">Docs</a>
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Blog Articles</p> 
              <a href="/blog"
                class="block rounded-md ml-5 px-3 py-2 text-blue-700 hover:bg-gray-50">Blog</a>
            
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Resources</p>
                
                <div class="ml-5">
                  
                    <a href="/about"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">About</a>
                  
                    <a href="/careers"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Careers</a>
                  
                    <a href="/press-releases"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Press</a>
                  
                    <a href="/resources"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Articles</a>
                  
                    <a href="/webinars"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Webinars</a>
                  
                    <a href="https://www.youtube.com/@infinyon/videos"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Videos</a>
                  </div></div>
    </div>
  </div>
</div>
</div>

      </header>
<main>
  <div class="flex flex-1 items-start overflow-hidden max-w-7xl mx-auto py-6">
  <main class="flex-1 overflow-y-auto">
    <section aria-labelledby="primary-heading" class="flex min-w-0 flex-1 flex-col">
      <div class="mx-5">
        <div class="mb-6">
          <nav class="flex" aria-label="Breadcrumb">

  <ol role="list" class="flex items-center space-x-1">
    <li>
      <svg class="h-5 w-5 flex-shrink-0 text-magenta-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M18.75 19.5l-7.5-7.5 7.5-7.5m-6 15L5.25 12l7.5-7.5" />
      </svg>
    </li>
    <li>
      <a href="/blog" class="text-base text-magenta-200 hover:underline">Blog</a>
    </li>
  </ol>
  <div class="grow"></div>

  <div class="flex flex-row mr-5 items-end text-gray-500">
    <div class="flex items-center text-base  hidden sm:inline-flex whitespace-nowrap">
      <svg class="mr-1.5 h-5 x-5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>      
      Read Time: 16 minutes
    </div>
    <div class="flex items-center text-base ml-4">
      <svg class="mr-1.5 h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
      </svg>
      January 05, 2021
    </div>
  </div>

</nav></div>
        <div class="mb-6">
          <h1 class="text-2xl md:text-3xl font-semibold font-md tracking-tight tracking-wide leading-tight bg-gradient-to-r from-magenta-800 to-magenta-300 inline-block text-transparent bg-clip-text">
  Websocket Glue for Data Streaming Apps
</h1></div>
        <div class="w-full lg:block hidden">
          <img class="mx-auto aspect-[19/10] rounded-lg lg:h-80" src="/blog/images/websocket-glue/social/ws-glue.jpg" alt="Websocket Glue for Data Streaming Apps">
        </div>
        <div class="block lg:hidden mt-4">
          <div class="flex flex-row">
            <div class="ml-4">
              <div class="flex flex-col">
  <img src="https://avatars.githubusercontent.com/ajhunyady" alt="A.J. Hunyady" class="h-16 w-16 rounded-full bg-gray-100">
  <div class="text-base leading-6 pt-2">
    <p class="font-semibold text-gray-900">
      <a href="https://github.com/ajhunyady">
        A.J. Hunyady
      </a>
    </p>
    <p class="text-sm text-gray-600">
      Co-founder &amp; CEO, InfinyOn
    </p>
  </div>
</div>
</div>
            <div class="grow"></div>
            <div class="flex flex-col mr-4 sm:mr-10">
              <h5 class="text-base text-gray-500">SHARE ON</h5>
              <div class="mt-1 pt-2">
                <div class="flex flex-row">
  <div class="pr-2 hover:brightness-75">
    <a class="twitter" title="Share on Twitter"
        href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&text=Websocket%20Glue%20for%20Data%20Streaming%20Apps"
        target="_blank">
        <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#00aced"></circle>
  <path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="button reddit" title="Share on Reddit"
      href="https://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&title=Websocket%20Glue%20for%20Data%20Streaming%20Apps&text=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#ff4500"></circle>
  <path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="linkedin" title="Share on LinkedIn"
      href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&title=Websocket%20Glue%20for%20Data%20Streaming%20Apps&summary=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#007fb1"></circle>
  <path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white">
  </path>
</svg></a>
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="ycombinator" title="Share on Y Combinator"
      href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&t=Websocket%20Glue%20for%20Data%20Streaming%20Apps&text=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <circle cx="128" cy="128" r="125" fill="#FB651E"></circle>
	<path d="M119.373653,144.745813 L75.43296,62.4315733 L95.5144533,62.4315733 L121.36192,114.52416 C121.759575,115.452022 122.2235,116.413008 122.753707,117.407147 C123.283914,118.401285 123.747838,119.428546 124.145493,120.48896 C124.410597,120.886615 124.609422,121.251127 124.741973,121.582507 C124.874525,121.913886 125.007075,122.212123 125.139627,122.477227 C125.802386,123.802744 126.39886,125.095105 126.929067,126.354347 C127.459274,127.613589 127.923198,128.773399 128.320853,129.833813 C129.381268,127.580433 130.541078,125.1614 131.80032,122.57664 C133.059562,119.99188 134.351922,117.307747 135.67744,114.52416 L161.92256,62.4315733 L180.612267,62.4315733 L136.27392,145.739947 L136.27392,198.826667 L119.373653,198.826667 L119.373653,144.745813 Z" fill="white">
  </path>
</svg></a>
  </div>
</div></div>
              <div class="mt-1 pt-2">
                <div class="github">
  <a href="https://gitHub.com/infinyon/fluvio/stargazers/"><img src="https://img.shields.io/github/stars/infinyon/fluvio?style=social" alt="GitHub stars"></a>
</div></div>
            </div>
          </div>
        </div>
        <div class="blog mt-8 lg:max-w-5xl max-w-7xl prose prose-quoteless prose-zing prose-md">
          <p>Modern applications need to interact with their users in real-time which require real time data streaming support. While we had Fluvio to handle data streaming, we needed a websocket connection proxy to bridge the data streaming with web applications.</p>
<p>This websocket connection layer should have the following properties:</p>
<ul>
<li>establish long-lived websocket connections</li>
<li>work natively in javascript for easy integration with front end clients</li>
<li>handle cookies for session identification</li>
<li>handle session management for server initiated connections</li>
<li>scale to a large number of concurrent sessions</li>
</ul>
<p>Since we couldn&rsquo;t find such code we ended up building it ourselves. We used this solution in both of our data streaming apps: Chat App and Bot Assistant.</p>
<p>If you want to jump right into it, you can download it from <a href="https://github.com/infinyon/fluvio-demo-apps-node/tree/master/websocket-glue" target="_blank">github</a>. The rest of this article takes you through a step-by-step on how we&rsquo;ve built this solution one component at a time.</p>
<h4 id="overview">Overview</h4>
<p>Websocket is a well established client/server communication mechanism for real-time data exchange. Most modern web browsers have built-in websocket libraries ready for use by front-end clients. There are also well established websocket libraries for most programming language which gives us a variety of choices for the backend server.</p>
<p>This project is using the following technologies:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank">Javascript</a> - for the front end client</li>
<li><a href="https://nodejs.org/">Node.js</a> and <a href="https://www.typescriptlang.org/docs/" target="_blank">TypeScript</a> for backend server.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket" target="_blank">WebSocket</a> - for real-time communication</li>
</ul>
<p>This blog is written in a set-by-step tutorial format:</p>
<ul>
<li><a href="#step-1-add-backend-server">Step 1: Add backend server</a></li>
<li><a href="#step-2-add-frontend-client">Step 2: Add frontend client</a></li>
<li><a href="#step-3-add-websocket-communication">Step 3: Add websocket communication</a></li>
<li><a href="#step-4-add-session-support">Step 4: Add session support</a></li>
</ul>
<p>This blog is part of a series of tutorials that shows the power of combining the Websocket glue with <a href="https://github.com/infinyon/fluvio">Fluvio</a> to build full featured data streaming apps.</p>
<h4 id="architecture">Architecture</h4>
<p>The goals is to create a session aware client/server websocket mechanism that we can leveraged by any real-time data streaming apps.</p>
<p><img src="/blog/images/websocket-glue/architecture.svg"
alt="WebSocket Architecture"
style="margin: auto; max-width: 440px" /></p>
<p>Let&rsquo;s get started.</p>
<h2 id="step-1-add-backend-server">Step 1: Add backend server</h2>
<p>The backend websocket server uses <code>Node.js</code> and <code>Typescript</code>. First we setup the environment, then we implement the websocket connection handler.</p>
<h3 id="add-nodejs-server">Add Node.js server</h3>
<p>Let&rsquo;s create a directory <code>websocket-glue</code>:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir websocket-glue <span class="o">&amp;&amp;</span> <span class="nb">cd</span> websocket-glue
</span></span></code></pre></div><p>Initialize node (this example uses Node v13.5.0):</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm init --yes
</span></span></code></pre></div><p>It generates the following <code>package.json</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;websocket-glue&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;description&#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;main&#34;</span>: <span class="s2">&#34;index.js&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;scripts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;test&#34;</span>: <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;keywords&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;author&#34;</span>: <span class="s2">&#34;fluvio &lt;admin@fluvio.io&gt; (fluvio.io)&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;license&#34;</span>: <span class="s2">&#34;Apache 2.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Install <code>express</code>, <code>typescript</code> and <code>ts-node</code> services:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install typescript ts-node express
</span></span></code></pre></div><p>Install <code>tsc-watch</code> and typescript definitions:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install -D tsc-watch @types/node @types/express
</span></span></code></pre></div><ul>
<li><strong>typescript</strong>: package to add static typing and strict syntactical check to JavaScript.</li>
<li><strong>ts-node</strong>: package for using TypeScript with Node.js. For example: <code>ts-node app.ts</code>.</li>
<li><strong>tsc-watch</strong>: a development tool to restart the server on code changes.</li>
<li><strong>express</strong>: web application framework for routing, cookies, and more.</li>
<li><strong>@types/node</strong>: typescript library for <code>Node.js</code>.</li>
<li><strong>@types/express</strong>: typescript library <code>express</code> application server.</li>
</ul>
<h3 id="add-typescript-configuration">Add typescript configuration</h3>
<p>Next, create a typescript configuration file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ touch tsconfig.json
</span></span></code></pre></div><p>Paste the following content in <code>tsconfig.json</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;compilerOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;es6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;module&#34;</span><span class="p">:</span> <span class="s2">&#34;commonjs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;lib&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">			<span class="s2">&#34;dom&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s2">&#34;ES2017&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s2">&#34;ES2015&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="p">],</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;outDir&#34;</span><span class="p">:</span> <span class="s2">&#34;dist&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;rootDir&#34;</span><span class="p">:</span> <span class="s2">&#34;./src&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;strict&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;moduleResolution&#34;</span><span class="p">:</span> <span class="s2">&#34;node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nt">&#34;esModuleInterop&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>For additional information on the typescript configuration parameters, checkout the documentation <a href="https://www.typescriptlang.org/tsconfig" target="_blank">here</a>.</p>
<h3 id="add-serverts-file">Add server.ts file</h3>
<p>It&rsquo;s time to add the <code>src</code> directory and provision the <code>server.ts</code> file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir src <span class="o">&amp;&amp;</span> touch src/server.ts
</span></span></code></pre></div><p>Paste the following content in <code>src\server.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span>
</span></span></code></pre></div><p>In summary, the code:</p>
<ul>
<li>creates an express application framework.</li>
<li>attaches express to the http webserver.</li>
<li>starts the webserver on port 9998.</li>
</ul>
<h4 id="update-nodejs-configuration">Update Node.js configuration</h4>
<p>Updated <code>package.json</code> configuration file to run <code>server.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;websocket-glue&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;server.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="nt">&#34;start:dev&#34;</span><span class="p">:</span> <span class="s2">&#34;tsc-watch --onSuccess \&#34;node ./dist/server.js\&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line hl"><span class="cl">    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;npx ts-node ./src/server.ts&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;keywords&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;fluvio &lt;admin@fluvio.io&gt; (fluvio.io)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;Apache 2.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;express&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ts-node&#34;</span><span class="p">:</span> <span class="s2">&#34;^9.1.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;typescript&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.1.3&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@types/express&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.9&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@types/node&#34;</span><span class="p">:</span> <span class="s2">&#34;^14.14.16&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;tsc-watch&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.2.9&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<ul>
<li>update <code>main</code> to server.js</li>
<li>add 2 scripts: <code>start:dev</code> for development and <code>start</code> for production.</li>
</ul>
<h3 id="test-backend-server">Test backend server</h3>
<p>Let&rsquo;s sanity check the directory hierarchy:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree -I <span class="s1">&#39;node_modules|dist&#39;</span>
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── package-lock.json
</span></span><span class="line"><span class="cl">├── package.json
</span></span><span class="line"><span class="cl">├── src
</span></span><span class="line"><span class="cl">│   └── server.ts
</span></span><span class="line"><span class="cl">└── tsconfig.json
</span></span></code></pre></div><p>Run the server:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm run start:dev
</span></span><span class="line"><span class="cl">7:28:31 AM - Starting compilation in watch mode...
</span></span><span class="line"><span class="cl">7:28:34 AM - Found <span class="m">0</span> errors. Watching <span class="k">for</span> file changes.
</span></span><span class="line"><span class="cl">started websocket server at ws://localhost:9998...
</span></span></code></pre></div><p>Congratulations, the server is up and running.</p>
<h2 id="step-2-add-frontend-client">Step 2: Add frontend client</h2>
<p>The frontend client is a simple html and javascript file that establishes a websocket connection with the server. In this section we&rsquo;ll hook-up the html file to the web server.</p>
<h3 id="add-indexhtml-file">Add index.html file</h3>
<p>The webserver we have implemented for the backend will also serve the frontend. We&rsquo;ll add the frontend code in a <code>public</code> directory.</p>
<p>Let&rsquo;s create the public directory and add <code>index.html</code> file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir public <span class="o">&amp;&amp;</span> touch public/index.html
</span></span></code></pre></div><p>Paste the following code in <code>index.html</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#f4f6f5</span><span class="p">;}</span> <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;connect&#34;</span><span class="p">&gt;</span>Connect<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;disconnect&#34;</span><span class="p">&gt;</span>Disconnect<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;message&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">size</span><span class="o">=</span><span class="s">&#34;20&#34;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&#34;240&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;ping&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;sendMessage&#34;</span><span class="p">&gt;</span>SendMessage<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;output&#34;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&#34;20&#34;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&#34;60&#34;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>The code has a standard HTML header with some background color and a body with the following elements:</p>
<ul>
<li><code>connect</code> and <code>disconnect</code> buttons to connect with websocket server.</li>
<li><code>message</code> input and <code>sendMessage</code> button to send messages to the server.</li>
<li><code>output</code> textarea to log the progress of the communication exchange.</li>
</ul>
<h3 id="hookup-indexhtml-to-server">Hookup index.html to server</h3>
<p>To hook-up <code>index.html</code> file we need to update <code>src\server.ts</code>:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s2">&#34;path&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="kr">const</span> <span class="nx">publicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span></span></span></code></pre></div>
<ul>
<li>cache <code>publicPath</code>, the path to the public directory.</li>
<li>add a route to retrieve <code>index.html</code> for the root URL.</li>
</ul>

<div class="mb-3"><aside class="callout idea">
  <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.0" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18" />
  </svg>
  <div class="content">
 <strong>NOTE</strong>: <code>tsc-watch</code> automatically refreshed the server.
</div></aside></div>
<h3 id="test-frontend-client">Test frontend client</h3>
<p>Open a web browser and navigate to <code>http://localhost:9998/</code>.</p>
<p><img src="/blog/images/websocket-glue/frontend.svg"
alt="WebSocket Frontend"
style="margin: auto; max-width: 540px" /></p>
<p>Congrats! Client/server scaffolding is done. Next we&rsquo;ll focus on the websocket communication.</p>
<h2 id="step-3-add-websocket-communication">Step 3: Add websocket communication</h2>
<p>In this section, we&rsquo;ll implement the client and the server side of the WebSocket (WS) protocol. Let&rsquo;s start with the server side.</p>
<h3 id="implement-websocket-server">Implement websocket server</h3>
<p>Server side websocket implementation has has multiple steps:</p>
<ul>
<li><a href="#install-ws-package">Install ws package</a></li>
<li><a href="#add-incoming-proxy">Add incoming proxy</a></li>
<li><a href="#attach-proxy-to-server">Attach proxy to server</a></li>
</ul>
<h4 id="install-ws-package">Install <code>ws</code> package</h4>
<p>In node there is a Websocket package, called <code>ws</code>, available for download through <strong>npm</strong>.</p>
<p>Install <code>ws</code> package and the typescript definition file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install ws <span class="o">&amp;&amp;</span> npm install -D @types/ws
</span></span></code></pre></div><h4 id="add-incoming-proxy">Add incoming proxy</h4>
<p>Our websocket implementation is a proxy server that intermediates the communication between clients and the server business logic. As the solution allows the clients or the server to initiate requests, we&rsquo;ll create two separate files <strong>proxy-in</strong> and <strong>proxy-out</strong>. This separation gives us better division of responsibility between incoming and outgoing requests. We&rsquo;ll come back to this in <a href="#step-4-add-session-support">Step 4</a>.</p>
<p>Incoming proxy is responsible for the websocket negotiation and message handling for incoming requests. Let&rsquo;s add the file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ touch src/proxy-in.ts
</span></span></code></pre></div><p>Paste the following content in the <code>src/proxy-in.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WS</span> <span class="kr">from</span> <span class="s2">&#34;ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">WsProxyIn</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">wss</span>: <span class="kt">WS.Server</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WS</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">clientTracking</span>: <span class="kt">false</span><span class="p">,</span> <span class="nx">noServer</span>: <span class="kt">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">init</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;upgrade&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">handleUpgrade</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span>: <span class="kt">WS</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="nx">ws</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onConnection() {</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;session opened&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;close&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;session closed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">clientMsg</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&lt;== </span><span class="si">${</span><span class="nx">clientMsg</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;ok&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">clientMsg</span> <span class="o">==</span> <span class="s2">&#34;ping&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;pong&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;==&gt; &#34;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>In summary, the code:</p>
<ul>
<li>accepts new websocket connections in the <code>upgrade</code> event.</li>
<li>emits a <code>connection</code> event.</li>
<li>captures the <code>connection</code> event in a new thread.</li>
<li>checks the data in the <code>message</code> event and replies with <code>pong</code> for <code>ping</code> and <code>ok</code> for everything else.</li>
</ul>
<p>For addition information on how websocket package works, checkout the documentation in <a href="https://github.com/websockets/ws" target="_blank">github</a>.</p>
<h4 id="attach-proxy-to-server">Attach proxy to server</h4>
<p>We&rsquo;ll hook-up the incoming proxy in the <code>src/server.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s2">&#34;path&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyIn</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-in&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">publicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="kr">const</span> <span class="nx">wsProxyIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyIn</span><span class="p">();</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="nx">wsProxyIn</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span></span></span></code></pre></div>
<p>The code imports and initializes the incoming proxy with the websocket server instance.</p>
<h3 id="implement-websocket-client">Implement websocket client</h3>
<p>The client utilizes the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank">Websocket API</a> available in most modern web browsers.</p>
<p>Client side websocket implementation has several steps:</p>
<ul>
<li><a href="#add-websocket-script-file">Add websocket script file</a></li>
<li><a href="#load-script-to-html-file">Load script to html file</a></li>
<li><a href="#add-scripts-route-to-serve">Add scripts route to server</a></li>
</ul>
<h4 id="add-websocket-script-file">Add websocket script file</h4>
<p>The script implements websocket connection and messages exchanges. It also attaches the DOM buttons we defined in the <code>index.html</code> file.</p>
<p>In a terminal, create the <code>ws-script.js</code> file:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir public/scripts <span class="o">&amp;&amp;</span> touch public/scripts/ws-script.js
</span></span></code></pre></div><p>Paste the following code in <code>public/scripts/ws-script.js</code>:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SERVER_HOST</span> <span class="o">=</span> <span class="s2">&#34;localhost:9998&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">webSocket</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">connectBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;connect&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">disconnectBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;disconnect&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">sendMessageBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sendMessage&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">messageEditor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">connectBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">onConnectClick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">disconnectBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">onDisconnectClick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sendMessageBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">onSendMessageClick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">messageEditor</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;keydown&#34;</span><span class="p">,</span> <span class="nx">onEditorKeys</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">openWSConnection</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">webSocket</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="s2">&#34;ws://&#34;</span> <span class="o">+</span> <span class="nx">SERVER_HOST</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">logOutput</span><span class="p">(</span><span class="s2">&#34;Connecting to: &#34;</span> <span class="o">+</span> <span class="nx">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">openEvent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">logOutput</span><span class="p">(</span><span class="s2">&#34;Connected!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">closeEvent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">webSocket</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nx">logOutput</span><span class="p">(</span><span class="s2">&#34;Disconnected!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">errorEvent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">logOutput</span><span class="p">(</span><span class="sb">`Error: </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">errorEvent</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">messageEvent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">serverMsg</span> <span class="o">=</span> <span class="nx">messageEvent</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nx">logOutput</span><span class="p">(</span><span class="sb">`&lt;== </span><span class="si">${</span><span class="nx">serverMsg</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">logOutput</span><span class="p">(</span><span class="sb">`error: </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">exception</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">onConnectClick</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">openWSConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">onDisconnectClick</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">webSocket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">logOutput</span><span class="p">(</span><span class="sb">`Not Connected!`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">onSendMessageClick</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">webSocket</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">).</span><span class="nx">value</span> <span class="o">||</span> <span class="s2">&#34;ping&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">logOutput</span><span class="p">(</span><span class="s2">&#34;==&gt; &#34;</span> <span class="o">+</span> <span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">webSocket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">logOutput</span><span class="p">(</span><span class="sb">`Not Connected!`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">onEditorKeys</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="s1">&#39;Enter&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onSendMessageClick</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">logOutput</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">debugOutput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;output&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">debugOutput</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">debugOutput</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="nx">value</span> <span class="o">+</span> <span class="s2">&#34;\n\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">debugOutput</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">debugOutput</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>The code performs the following operations:</p>
<ul>
<li><strong>init</strong>: attaches DOM objects to their handlers.</li>
<li><strong>openWSConnection</strong>: uses WebSocket API to initiate a websocket connection. It also registers callback handlers for websocket operations.</li>
<li><strong>onConnectClick</strong>: click handler to open a websocket connection.</li>
<li><strong>onDisconnectClick</strong>: click handler to close the websocket connection.</li>
<li><strong>onSendMessageClick</strong>: click handler to send message on websocket connection.</li>
<li><strong>onEditorKeys</strong>: Captures the enter key invoke send message.</li>
<li><strong>logOutput</strong>: Prints messages in the textarea.</li>
</ul>
<h4 id="load-script-to-html-file">Load script to html file</h4>
<p>Next, we&rsquo;ll update <code>index.html</code> to load the <code>ws-script.js</code>:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="nt">body</span> <span class="p">{</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#f4f6f5</span><span class="p">;}</span> <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line hl"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type </span><span class="o">=</span> <span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;scripts/ws-script.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;connect&#34;</span><span class="p">&gt;</span>Connect<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;disconnect&#34;</span><span class="p">&gt;</span>Disconnect<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;message&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">size</span><span class="o">=</span><span class="s">&#34;20&#34;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&#34;240&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;ping&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;sendMessage&#34;</span><span class="p">&gt;</span>SendMessage<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;output&#34;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&#34;20&#34;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&#34;60&#34;</span> <span class="na">readonly</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></span></span></code></pre></div>
<p>The code attaches a script tag that loads <code>ws-script.js</code> file to the HTML headers.</p>
<h4 id="add-scripts-route-to-serve">Add scripts route to serve</h4>
<p>The script is not yet visible to your web server. Let&rsquo;s add a route to the web server <code>src/server.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s2">&#34;path&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyIn</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-in&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">publicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">wsProxyIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyIn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">wsProxyIn</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line hl"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;/scripts&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span></span></span></code></pre></div>
<p>The code defines a route that expose the <code>/scripts</code> directory to the web server.</p>
<h3 id="test-websocket-communication">Test websocket communication</h3>
<p>Open the web browser and refresh <code>http://localhost:9998/</code> to load the latest javascript code. You should see the same page as before, but the buttons should now be operational. Let&rsquo;s establish a a connection and send a message:</p>
<ul>
<li>click <code>Connect</code> should connect to the websocket server.</li>
<li>click <code>Send Message</code> should send &lsquo;ping&rsquo; to server.
<ul>
<li>server should respond with &lsquo;pong&rsquo;</li>
</ul>
</li>
<li>type &lsquo;hello word&rsquo; and click <code>Send Message</code> again.
<ul>
<li>server should respond with &lsquo;ok&rsquo;.</li>
</ul>
</li>
<li>click <code>Disconnect</code> to release websocket connection.</li>
</ul>
<p><img src="/blog/images/websocket-glue/websocket.svg"
alt="WebSocket Frontend"
style="margin: auto; max-width: 540px" /></p>
<p>Congratulations, you have a basic websocket glue is ready for use.</p>
<h2 id="step-4-add-session-support">Step 4: Add session support</h2>
<p>A websocket servers must be able to support multiple conversations in parallel, where each conversation is uniquely identified by a session id. The preferred method to managed these conversations is through <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank">HTTP cookies</a>.</p>
<p>Once a websocket session is established both, the client and the server can leverage it to initiate requests. Client initiated requests are straight forward as the session information is passed through header cookies. Server initiated requests are bit more involved as they require a session management layer.</p>
<p>In this section covers both aspects:</p>
<ul>
<li><a href="#add-session-cookies-for-client-requests">Add session cookies for client requests</a></li>
<li><a href="#add-session-management-for-server-requests">Add session management for server requests</a></li>
</ul>
<h3 id="add-session-cookies-for-client-requests">Add session cookies for client requests</h3>
<p>Web servers push cookies to clients through HTTP headers. After receipt, the clients attaches the cookies to each subsequent message it sends the server. Messages exchanged using the same cookie are also known as sessions.</p>
<p>Let&rsquo;s updates <code>src/proxy-in.ts</code> websocket server to generate and push session cookies:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WS</span> <span class="kr">from</span> <span class="s2">&#34;ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="kr">import</span> <span class="nx">crypto</span> <span class="kr">from</span> <span class="s1">&#39;crypto&#39;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl"><span class="kr">const</span> <span class="nx">COOKIE_NAME</span> <span class="o">=</span> <span class="s2">&#34;CookieName&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">WsProxyIn</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">wss</span>: <span class="kt">WS.Server</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WS</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">clientTracking</span>: <span class="kt">false</span><span class="p">,</span> <span class="nx">noServer</span>: <span class="kt">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">init</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;upgrade&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">parseCookie</span><span class="p">(</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">handleUpgrade</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span>: <span class="kt">WS</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="nx">ws</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onConnection() {</span>
</span></span><span class="line hl"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;headers&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">headers</span>: <span class="kt">Array</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;,</span> <span class="nx">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">parseCookie</span><span class="p">(</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="kd">let</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">                <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">                <span class="nx">headers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&#34;Set-Cookie: &#34;</span> <span class="o">+</span> <span class="nx">COOKIE_NAME</span> <span class="o">+</span> <span class="s2">&#34;=&#34;</span> <span class="o">+</span> <span class="nx">session</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">            <span class="p">}</span>
</span></span><span class="line hl"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="kr">const</span> <span class="nx">session_hdr</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">            <span class="kr">const</span> <span class="nx">sid</span> <span class="o">=</span> <span class="p">((</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">session_hdr</span><span class="p">))</span> <span class="o">?</span> <span class="nx">session_hdr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">session_hdr</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`session opened: </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;close&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`session closed: </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">clientMsg</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&lt;== </span><span class="si">${</span><span class="nx">clientMsg</span><span class="si">}</span><span class="sb"> from </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;ok&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">clientMsg</span> <span class="o">==</span> <span class="s2">&#34;ping&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;pong&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;==&gt; &#34;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">parseCookie</span><span class="p">(</span><span class="nx">cookieName</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">cookie_hdr?</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">cookie_hdr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">            <span class="kr">const</span> <span class="nx">cookiePair</span> <span class="o">=</span> <span class="nx">cookie_hdr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/; */</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">c</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="kr">const</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">                <span class="k">return</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">v</span><span class="p">)];</span>
</span></span><span class="line hl"><span class="cl">            <span class="p">}).</span><span class="nx">find</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span>
</span></span><span class="line hl"><span class="cl">                <span class="p">(</span><span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">cookieName</span><span class="p">)</span>
</span></span><span class="line hl"><span class="cl">            <span class="p">);</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">cookiePair</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">cookiePair</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="k">return</span> <span class="nx">cookiePair</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">            <span class="p">}</span>
</span></span><span class="line hl"><span class="cl">        <span class="p">}</span>
</span></span><span class="line hl"><span class="cl">        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>The code generates and assigns a session id to a cookie with arbitrary name. Then, it utilizes WebSocket headers to send it to the client.</p>
<p>The webSocket connection setup in two steps:</p>
<ol>
<li><code>headers</code> request</li>
<li><code>connection</code> request.</li>
</ol>
<p>In the <code>headers</code> request, the code checks the HTTP headers for the session cookie. If not found, it generates a new session id and appends the result to the HTTP header. WebSocket will take care of the rest. In <code>connection</code> callback, the code reads the session id from <code>request.headers.session</code>.</p>
<p>Finally, <code>parseSessionFromCookie</code> reads the session id from the cookie header and returns the the caller.</p>
<h3 id="test-session-cookies">Test session cookies</h3>
<p>Open the web browser and refresh <code>http://localhost:9998/</code>. Then, open browser cookies and look for an entry called <code>CookieName</code>. The cookie stores the session id.</p>
<p><img src="/blog/images/websocket-glue/webcookies.svg"
alt="WebSocket Frontend"
style="margin: auto; max-width: 580px" /></p>
<p>If you open a 2nd browser in <code>Incognito Mode</code> a new cookie is assigned.</p>
<p>At the terminal the web server logs new connection with the cookie information.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">started websocket server at ws://localhost:9998...
</span></span><span class="line"><span class="cl">session opened: 8771b27ee1c8af52e8473c2d8f8e3d932a654155
</span></span><span class="line"><span class="cl">&lt;<span class="o">==</span> hello from <span class="nv">8771b27ee1c8af52e8473c2d8f8e3d932a654155</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt;  ok
</span></span><span class="line"><span class="cl">session opened: 3cd4c1fd800f8adb0b1ca5a5a8cce80ce0335788
</span></span><span class="line"><span class="cl">&lt;<span class="o">==</span> ping from <span class="nv">3cd4c1fd800f8adb0b1ca5a5a8cce80ce0335788</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt;  pong
</span></span><span class="line"><span class="cl">session closed: 3cd4c1fd800f8adb0b1ca5a5a8cce80ce0335788
</span></span><span class="line"><span class="cl">session closed: 8771b27ee1c8af52e8473c2d8f8e3d932a654155
</span></span></code></pre></div><p>Congratulations, you have implemented session cookies using websocket.</p>
<h3 id="add-session-management-for-server-requests">Add session management for server requests</h3>
<p>Session management is an intermediate file that caches the session id with the websocket connection object. These cached connections allows server modules to send messages to any of the clients based on their session identifier.</p>
<h4 id="add-session-management-file">Add session management file</h4>
<p>Let&rsquo;s add the session management to a file called <code>proxy-out</code>:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ touch src/proxy-out.ts
</span></span></code></pre></div><p>Paste the following content in the <code>src/proxy-out.ts</code> file:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WS</span> <span class="kr">from</span> <span class="s2">&#34;ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">SID</span> <span class="o">=</span> <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">WsProxyOut</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">sessions</span>: <span class="kt">Map</span><span class="p">&lt;</span><span class="nt">SID</span><span class="err">,</span> <span class="na">WS</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">addSession</span><span class="p">(</span><span class="nx">sid</span>: <span class="kt">SID</span><span class="p">,</span> <span class="nx">ws</span>: <span class="kt">WS</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="nx">sid</span><span class="p">,</span> <span class="nx">ws</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">getSession</span><span class="p">(</span><span class="nx">sid</span>: <span class="kt">SID</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">closeSession</span><span class="p">(</span><span class="nx">sid</span>: <span class="kt">SID</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">sendMessage</span><span class="p">(</span><span class="nx">sid</span>: <span class="kt">SID</span><span class="p">,</span> <span class="nx">message</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">broadcastMessage</span><span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">ws</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">show() {</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Sessions&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sessions</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>WsProxyOut class saves session ids (SID) together with the Websocket connection in a Map object. Any module with a reference to this object can send messages to one or all clients.</p>
<h4 id="integrated-session-management">Integrated session management</h4>
<p>Sessions are generated inside incoming proxy file, hence the integration is done there. However, the sessions must be shareable with any number of server modules and it needs to be a top level object.</p>
<p>Let&rsquo;s update <code>src/proxy-in.ts</code>:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">WS</span> <span class="kr">from</span> <span class="s2">&#34;ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">crypto</span> <span class="kr">from</span> <span class="s1">&#39;crypto&#39;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyOut</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-out&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">COOKIE_NAME</span> <span class="o">=</span> <span class="s2">&#34;CookieName&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">WsProxyIn</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">wss</span>: <span class="kt">WS.Server</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">proxyOut</span>: <span class="kt">WsProxyOut</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="kr">constructor</span><span class="p">(</span><span class="nx">proxyOut</span>: <span class="kt">WsProxyOut</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WS</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="nx">clientTracking</span>: <span class="kt">false</span><span class="p">,</span> <span class="nx">noServer</span>: <span class="kt">true</span> <span class="p">});</span>
</span></span><span class="line hl"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">proxyOut</span> <span class="o">=</span> <span class="nx">proxyOut</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">public</span> <span class="nx">init</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">onConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onUpgrade</span><span class="p">(</span><span class="nx">server</span>: <span class="kt">http.Server</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;upgrade&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">parseCookie</span><span class="p">(</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">handleUpgrade</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">head</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span>: <span class="kt">WS</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="nx">ws</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="nx">onConnection() {</span>
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;headers&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">headers</span>: <span class="kt">Array</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;,</span> <span class="nx">req</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">parseCookie</span><span class="p">(</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kd">let</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">randomBytes</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="nx">headers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&#34;Set-Cookie: &#34;</span> <span class="o">+</span> <span class="nx">COOKIE_NAME</span> <span class="o">+</span> <span class="s2">&#34;=&#34;</span> <span class="o">+</span> <span class="nx">session</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;connection&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ws</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">session_hdr</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">sid</span> <span class="o">=</span> <span class="p">((</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">session_hdr</span><span class="p">))</span> <span class="o">?</span> <span class="nx">session_hdr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="nx">session_hdr</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">            <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">proxyOut</span><span class="p">.</span><span class="nx">addSession</span><span class="p">(</span><span class="nx">sid</span><span class="p">,</span> <span class="nx">ws</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`session opened: </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;close&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">                <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">proxyOut</span><span class="p">.</span><span class="nx">closeSession</span><span class="p">(</span><span class="nx">sid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`session closed: </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&#34;message&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">clientMsg</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`&lt;== </span><span class="si">${</span><span class="nx">clientMsg</span><span class="si">}</span><span class="sb"> from </span><span class="si">${</span><span class="nx">sid</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;ok&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">clientMsg</span> <span class="o">==</span> <span class="s2">&#34;ping&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">response</span> <span class="o">=</span> <span class="s2">&#34;pong&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">                <span class="nx">WsProxyIn</span><span class="p">.</span><span class="nx">proxyOut</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">sid</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;==&gt; &#34;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">private</span> <span class="kr">static</span> <span class="nx">parseCookie</span><span class="p">(</span><span class="nx">cookieName</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">cookie_hdr?</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">cookie_hdr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">cookiePair</span> <span class="o">=</span> <span class="nx">cookie_hdr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/; */</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">c</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kr">const</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">v</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}).</span><span class="nx">find</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nx">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">cookieName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">cookiePair</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">cookiePair</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nx">cookiePair</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>The code adds a private static variable <code>proxyOut</code> which stores a pointer to the session management object. When the connection status changes, <code>proxyOut</code> is notified to update its internal cache.</p>
<p>OnMessage API was also changed to use <code>proxyOut</code> for sending messages using the session id.</p>
<p>Next, we need to update <code>src\server.ts</code> to crate the session manager object an pass it to the incoming proxy:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s2">&#34;path&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyIn</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-in&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyOut</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-out&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">publicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="kr">const</span> <span class="nx">proxyOut</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyOut</span><span class="p">();</span>
</span></span><span class="line hl"><span class="cl">    <span class="kr">const</span> <span class="nx">wsProxyIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyIn</span><span class="p">(</span><span class="nx">proxyOut</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">wsProxyIn</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;/scripts&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span></span></span></code></pre></div>
<p>The code create a new <code>WsProxyOut</code> object and passes it to <code>WsProxyIn</code>.</p>
<h3 id="test-server-initiated-requests">Test server initiated requests</h3>
<p>To test server initiated requests, we&rsquo;ll add a simple timeout that triggers every 3 seconds and broadcasts a notification to all clients.</p>
<p>We&rsquo;ll temporarily add a trigger to <code>src\server.ts</code>:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="kr">from</span> <span class="s2">&#34;http&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="kr">from</span> <span class="s2">&#34;express&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">path</span> <span class="kr">from</span> <span class="s2">&#34;path&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyIn</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-in&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">WsProxyOut</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;./proxy-out&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">9998</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">startServer</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">Server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">publicPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">proxyOut</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyOut</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">wsProxyIn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WsProxyIn</span><span class="p">(</span><span class="nx">proxyOut</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">wsProxyIn</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">Server</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">    <span class="c1">// test broadcast
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>    <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">        <span class="nx">proxyOut</span><span class="p">.</span><span class="nx">broadcastMessage</span><span class="p">(</span><span class="s2">&#34;notify&#34;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">    <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;/scripts&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">publicPath</span><span class="p">,</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">Server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="sb">`started websocket server at ws://localhost:</span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb">...`</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">startServer</span><span class="p">();</span></span></span></code></pre></div>
<p>Navigate to your browser pointing at <code>http://localhost:9998/</code> and connect.
The <code>notify</code> message is printed to the output every 3 seconds:</p>
<p><img src="/blog/images/websocket-glue/websocket-notify.svg"
alt="WebSocket Frontend"
style="margin: auto; max-width: 540px" /></p>
<p>Congratulations, your session aware websocket glue is ready for use.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Websocket is a good choice for streaming real-time data between web server clients and backend servers. The blog shows that 220 lines of code is all you need to build your own real-time applications on websocket.</p>
<p>This websocket glue is used in the following sample applications:</p>
<ul>
<li><a href="http://localhost:1315/blog/2021/02/bot-assistant/">Build your own custom Bot Assistant</a></li>
<li><a href="http://localhost:1315/blog/2021/01/persistent-chat-app/">Build a persistent Chat App without a database</a></li>
</ul>
<p>You can reach us on <a href="https://discordapp.com/invite/bBG2dTz" target="_blank">discord</a>. We look forward to hearing from you.</p>

        </div>      
      </div>

    </section>
  </main> 

  <aside class="hidden mx-5 w-72 overflow-y-auto lg:block py-6">
  <article class="flex flex-col items-start px-4">

    <h2 class="text-sm text-gray-500 tracking-widest">
      SHARE ON
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-4 w-5/6" />
    <div class="w-full mx-auto pb-4">
      <div class="flex flex-row">
  <div class="pr-2 hover:brightness-75">
    <a class="twitter" title="Share on Twitter"
        href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&text=Websocket%20Glue%20for%20Data%20Streaming%20Apps"
        target="_blank">
        <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#00aced"></circle>
  <path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="button reddit" title="Share on Reddit"
      href="https://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&title=Websocket%20Glue%20for%20Data%20Streaming%20Apps&text=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#ff4500"></circle>
  <path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="linkedin" title="Share on LinkedIn"
      href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&title=Websocket%20Glue%20for%20Data%20Streaming%20Apps&summary=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#007fb1"></circle>
  <path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white">
  </path>
</svg></a>
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="ycombinator" title="Share on Y Combinator"
      href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f01%2fwebsocket-glue-for-streaming-apps&t=Websocket%20Glue%20for%20Data%20Streaming%20Apps&text=Create%20session-aware%20websocket%20glue%20that%20can%20be%20utilized%20by%20data%20streaming%20applications."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <circle cx="128" cy="128" r="125" fill="#FB651E"></circle>
	<path d="M119.373653,144.745813 L75.43296,62.4315733 L95.5144533,62.4315733 L121.36192,114.52416 C121.759575,115.452022 122.2235,116.413008 122.753707,117.407147 C123.283914,118.401285 123.747838,119.428546 124.145493,120.48896 C124.410597,120.886615 124.609422,121.251127 124.741973,121.582507 C124.874525,121.913886 125.007075,122.212123 125.139627,122.477227 C125.802386,123.802744 126.39886,125.095105 126.929067,126.354347 C127.459274,127.613589 127.923198,128.773399 128.320853,129.833813 C129.381268,127.580433 130.541078,125.1614 131.80032,122.57664 C133.059562,119.99188 134.351922,117.307747 135.67744,114.52416 L161.92256,62.4315733 L180.612267,62.4315733 L136.27392,145.739947 L136.27392,198.826667 L119.373653,198.826667 L119.373653,144.745813 Z" fill="white">
  </path>
</svg></a>
  </div>
</div></div>

    <h2 class="mt-4 text-sm text-gray-500 tracking-widest">
      AUTHOR
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-4 w-5/6" />

    <div class="w-full mx-auto flex flex-col items-start">
      <div class="flex flex-col">
  <img src="https://avatars.githubusercontent.com/ajhunyady" alt="A.J. Hunyady" class="h-16 w-16 rounded-full bg-gray-100">
  <div class="text-base leading-6 pt-2">
    <p class="font-semibold text-gray-900">
      <a href="https://github.com/ajhunyady">
        A.J. Hunyady
      </a>
    </p>
    <p class="text-sm text-gray-600">
      Co-founder &amp; CEO, InfinyOn
    </p>
  </div>
</div>
</div>

    <h2 class="mt-8 text-sm text-gray-500 tracking-widest">
      FLUVIO OSS
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-6 w-5/6" />
    <div class="github">
  <a href="https://gitHub.com/infinyon/fluvio/stargazers/"><img src="https://img.shields.io/github/stars/infinyon/fluvio?style=social" alt="GitHub stars"></a>
</div>
<h2 class="mt-12 text-sm text-gray-500 tracking-widest">
  INFINYON CLOUD
</h2>
<hr class="border-b-0 border-gray-200 w-full mt-3 pb-3" />
<div class="mt-2 py-5 w-full rounded-md bg-gradient-to-r from-magenta-800 to-magenta-400">
  <a href="https://infinyon.cloud/signup">
  <h3 class="text-base font-semibold text-pink-400 text-center">
    Accelerated Onboarding
  </h3>
  <div class="pt-1 flex flex-row">
    <div class="flex flex-col w-4/6 justify-center">
      <h5 class="text-xs text-gray-100 pl-3">
         Sign-up for personalized assistance from dedicated InfinyOn architect.
      </h5>
    </div>
    <div class="flex flex-col mt-2 mr-2 h-20 w-20 rounded-md bg-black items-center justify-center">
      <h5 class="text-base leading-5 font-bold text-neon-300 w-16 break-words text-center">
        Free $3000
      </h5>
        <h6 class="text-xxs text-gray-100 pt-1">
          2000 credits
        </h6>
    </div>
  </div>
  </a>
</div></article>
</aside></div>

<script src="/js/copy-code.js"></script></main>
    </div>
    <footer class="bg-gray-900" aria-labelledby="footer-heading">
  <h2 id="footer-heading" class="sr-only">Footer</h2>

  <div class="mx-auto max-w-7xl px-6 pb-16 pt-16 lg:px-8">
    <div class="lg:grid lg:grid-cols-10 lg:gap-8">

      
      <div class="lg:col-span-2 space-y-6">
        <img class="h-7 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
        <p class="text-sm leading-6 text-gray-300"></p>
        <div class="flex space-x-6">
            <a href="https://github.com/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">GitHub</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path fill-rule="evenodd"
        d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
        clip-rule="evenodd" />
</svg>
            </a>
            <a href="https://twitter.com/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">Twitter</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path
        d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
</svg>
            </a>
            <a href="https://linkedin.com/company/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">linkedin</span>
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" aria-hidden="true" viewBox="0 0 448 512">
  <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/>
</svg>
            </a>
            <a href="https://discordapp.com/invite/bBG2dTz" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">discord</span>
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" aria-hidden="true"
    viewBox="0 0 640 512">
    <path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z" />
</svg>
            </a>
            <a href="https://www.youtube.com/@infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">YouTube</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path fill-rule="evenodd"
        d="M19.812 5.418c.861.23 1.538.907 1.768 1.768C21.998 8.746 22 12 22 12s0 3.255-.418 4.814a2.504 2.504 0 0 1-1.768 1.768c-1.56.419-7.814.419-7.814.419s-6.255 0-7.814-.419a2.505 2.505 0 0 1-1.768-1.768C2 15.255 2 12 2 12s0-3.255.417-4.814a2.507 2.507 0 0 1 1.768-1.768C5.744 5 11.998 5 11.998 5s6.255 0 7.814.418ZM15.194 12 10 15V9l5.194 3Z"
        clip-rule="evenodd" />
</svg>
            </a>
        </div>
      </div>

      
      <div class="lg:col-span-8">
        <div class="mt-16 lg:mt-0 grid grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-12">
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Cloud</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/infinyon-cloud" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Cloud
                </a>
                </li>
                <li>
                  <a href="https://infinyon.cloud/signup" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Sign Up
                </a>
                </li>
                <li>
                  <a href="https://infinyon.cloud/login" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Login
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Product</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Platform
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Hub
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Connectors
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Webhooks
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    SmartModules
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Event Streams
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Stateful Streams
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Solutions</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/iot" class="text-sm leading-6 text-gray-300 hover:text-white">
                    IoT Aggregation
                </a>
                </li>
                <li>
                  <a href="/clickstream" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Website Monitoring
                </a>
                </li>
                <li>
                  <a href="/" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Microservices Event Bridge
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">About</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/about" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Company
                </a>
                </li>
                <li>
                  <a href="/careers" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Careers
                </a>
                </li>
                <li>
                  <a href="/resources" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Articles
                </a>
                </li>
                <li>
                  <a href="/press-releases" class="text-sm leading-6 text-gray-300 hover:text-white">
                    News
                </a>
                </li>
                <li>
                  <a href="/webinars" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Webinars
                </a>
                </li>
                <li>
                  <a href="https://www.youtube.com/@infinyon/videos" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Videos
                </a>
                </li>
                <li>
                  <a href="/blog" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Blog
                </a>
                </li>
            </ul>
          </div>
          
        </div>
      </div>

    </div>

    
    <div class="mt-8 border-t border-white/10 pt-4 text-center">
      <div class="text-center text-xs text-gray-400">
        
        <span><a href="/legal/privacy">Privacy Policy</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/security">Security</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/user-agreement">Terms and Conditions</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/cookies">Cookie Notice</a></span>
          
      </div>
      <p class="text-xs leading-5 text-gray-400">&copy; <span id="year"></span> InfinyOn, Inc. All rights reserved.</p>
      <script>
        document.getElementById("year").innerHTML = new Date().getFullYear();
      </script>
    </div>
  </div>
</footer>
    
  </body>
</html>