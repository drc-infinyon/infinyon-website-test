<!DOCTYPE html>
<html class="h-full">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1315&amp;path=livereload" data-no-instant defer></script>
    <title>Sending tuples from Node to Rust and back</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet"><script defer src="/js/alpine_3_11_1.js"></script>

  <meta property="og:type" content="article" />
  <meta property="og:title" content="Sending tuples from Node to Rust and back" />
  <meta property="og:description" content="How I added tuple support to node-bindgen." />
  <meta property="og:image" content="http://localhost:1315/blog/images/batch-producer/rust-node-blog-social.png">
  <meta name="twitter:site" content="@InfinyOn">
  <meta name="twitter:image:src" content="http://localhost:1315/blog/images/batch-producer/rust-node-blog-social.png" />
  <meta name="twitter:card" content="summary_large_image" />

  </head>
  <body>
    
<div class="relative isolate flex items-center gap-x-6 overflow-hidden bg--100 py-2.5 px-6 sm:px-3.5 sm:before:flex-1 bg-indigo-300">
  <div class="flex flex-auto items-center gap-y-2 gap-x-4">
    <p class="text-sm leading-6 text-gray-900">
      <strong class="font-semibold">Stateful Services (private release)</strong>
      <svg viewBox="0 0 2 2" class="mx-2 inline h-0.5 w-0.5 fill-current" aria-hidden="true"><circle cx="1" cy="1" r="1" /></svg>
      Build composable event-driven data pipelines in minutes.
    </p>
    <a href="/request/ss-early-access" class="flex-none rounded-full bg-gray-900 py-1 px-3.5 text-sm font-semibold text-white shadow-sm hover:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-900">
      Request access <span aria-hidden="true">&rarr;</span>
    </a>
  </div>
</div><div id="content">
      <header id="header" class="sticky top-0 z-20">
        <div 
  x-data="{ isOpen: false, menuOpen: '', showBorder: false }"
  @scroll.window="showBorder = (document.querySelector('#header').getBoundingClientRect().top <= 0 && window.pageYOffset > 2 ) ? true : false"
  :class="{ 'border-b border-gray-700' : showBorder}"
>
  <div class="bg-magenta-900 pt-4 pb-4">
    <nav class="relative mx-auto flex max-w-7xl items-center justify-between px-6" aria-label="Global">
      <div class="flex flex-1 items-center">
        <div class="flex w-full items-center justify-between md:w-auto">
          <a href="/">
            <span class="sr-only">InfinyOn</span>
            <img class="h-6 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
          </a>

          <div class="-mr-2 flex items-center md:hidden">
            <button 
              @click="isOpen = !isOpen" 
              type="button" 
              class="focus-ring-inset inline-flex items-center justify-center rounded-md bg-magenta-900 p-2 text-gray-400 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-white" aria-expanded="false"
              >
              <span class="sr-only">Open main menu</span>
              
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.4" stroke="white" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
              </svg>
            </button>                  
          </div>
        </div>

        <div class="hidden space-x-8 md:ml-10 md:flex">
              
            <div x-data="{ showDropdown: false }">
  <button 
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    @click="showDropdown = !showDropdown"
    type="button" 
    :class="{ 'text-gray-900' : showDropdown }"
    class="group inline-flex items-center rounded-md text-base text-white hover:text-gray-300" aria-expanded="false">
    <span>Use Cases</span>
    <svg 
      :class="{ 'rotate-90 text-gray-300' : showDropdown }"
      class="ml-2 h-4 w-4 text-white group-hover:text-gray-300"
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
    </svg>
  </button>

  <div
    x-cloak
    x-show="showDropdown"
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    class="absolute z-10 pt-3 transform shadow-lg"
  >

    <div class="overflow-hidden rounded-md shadow-md ring-1 ring-black ring-opacity-5">
        <div class="relative px-8 py-7 bg-slate-50" aria-labelledby="solutions-heading">
          <ul role="list" class="space-y-5">
              <li class="flow-root">
                <a href="/clickstream" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zm-7.518-.267A8.25 8.25 0 1120.25 10.5M8.288 14.212A5.25 5.25 0 1117.25 10.5" />
</svg><span class="ml-4">Clickstream Analytics</span>
                </a>
              </li>
              <li class="flow-root">
                <a href="/iot" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.348 14.651a3.75 3.75 0 010-5.303m5.304 0a3.75 3.75 0 010 5.303m-7.425 2.122a6.75 6.75 0 010-9.546m9.546 0a6.75 6.75 0 010 9.546M5.106 18.894c-3.808-3.808-3.808-9.98 0-13.789m13.788 0c3.808 3.808 3.808 9.981 0 13.79M12 12h.008v.007H12V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
</svg><span class="ml-4">IoT Mirroring</span>
                </a>
              </li>
              <li class="flow-root">
                <a href="/stateful-streaming" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                  <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
</svg>
<span class="ml-4">Stateful Streaming</span>
                </a>
              </li>
          </ul>
        </div>
    </div>
  </div>
  
</div>    
            
<a href="/docs" class="text-base text-white hover:text-gray-300 " class="">Docs</a>    
            
<a href="/blog" class="text-base text-white hover:text-gray-300  underline underline-offset-8 decoration-1" class="">Blog</a>    
            <div x-data="{ showDropdown: false }">
  <button 
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    @click="showDropdown = !showDropdown"
    type="button" 
    :class="{ 'text-gray-900' : showDropdown }"
    class="group inline-flex items-center rounded-md text-base text-white hover:text-gray-300" aria-expanded="false">
    <span>Resources</span>
    <svg 
      :class="{ 'rotate-90 text-gray-300' : showDropdown }"
      class="ml-2 h-4 w-4 text-white group-hover:text-gray-300"
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
    </svg>
  </button>

  <div
    x-cloak
    x-show="showDropdown"
    @mouseover="showDropdown = true"
    @mouseleave="showDropdown = false"
    class="absolute z-10 pt-3 transform shadow-lg"
  >

    <div class="overflow-hidden rounded-md shadow-md ring-1 ring-black ring-opacity-5">
        <div class="relative px-16 py-8 grid grid-cols-2 gap-24 bg-slate-50" aria-labelledby="solutions-heading">

          <div>
            <h3 class="text-md text-gray-700">Company</h3>
            <ul role="list" class="mt-4 space-y-6">
                <li class="flow-root">
                  <a href="/about" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
</svg><span class="ml-4">About</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/careers" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0M12 12.75h.008v.008H12v-.008z" />
</svg><span class="ml-4">Careers</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/press-releases" target="_self" class="-m-3 flex items-center rounded-md p-3 text-gray-700 hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
</svg><span class="ml-4">Press</span>
                  </a>
                </li>

            </ul>
          </div>

          <div>
            <h3 class="text-md text-gray-700">Resources</h3>
            <ul role="list" class="mt-4 space-y-6">
                <li class="flow-root">
                  <a href="/resources" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6A2.25 2.25 0 016 3.75h1.5m9 0h-9" />
</svg><span class="ml-4">Articles</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="/webinars" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
</svg><span class="ml-4">Webinars</span>
                  </a>
                </li>
                <li class="flow-root">
                  <a href="https://www.youtube.com/@infinyon/videos" class="-m-3 flex items-center rounded-md p-3 text-gray-700  hover:bg-slate-100">
                    <svg class="w-6 h-6 text-magenta-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z" />
</svg><span class="ml-4">Videos</span>
                  </a>
                </li>

            </ul>
          </div>
        </div>
  
    </div>
  </div>
  
</div>    
                
            </div>

      </div>
      
      <div class="hidden md:flex md:items-center md:space-x-6">
            
          
        <a href="https://infinyon.cloud?utm_campaign=global%20cloud%20link&amp;utm_source=website&amp;utm_medium=global%20button&amp;utm_term=infinyon%20cloud&amp;utm_content=cloud-registration" class="inline-flex items-center rounded-md px-4 py-1.5 text-sm font-semibold text-white bg-indigo-500 hover:bg-indigo-600">Cloud Login</a>
      </div>
    </nav>
  </div>

  <div class="absolute inset-x-0 top-0 px-2 origin-top transform transition md:hidden">
  <div x-show="isOpen" x-cloak x-transition:enter="duration-150 ease-out" x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100" x-transition:leave="duration-100 ease-in"
    x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
    class="overflow-hidden rounded-lg bg-slate-50 shadow-lg ring-1 ring-black ring-opacity-5">

    <div class="flex items-center justify-between px-5 pt-4 pb-2 bg-magenta-900">
      <div>
        <a href="/">
          <span class="sr-only">InfinyOn</span>
          <img class="h-6 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
        </a>
      </div>
      <div class="-mr-2">
        <button type="button" @click="isOpen = !isOpen"
          class="inline-flex items-center justify-center rounded-md bg-white p-2 text-gray-400 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cyan-600">
          <span class="sr-only">Close menu</span>
          
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <div class="pt-5 pb-6 max-h-screen -mb-16 overflow-y-auto">
      <div class="mb-16 space-y-1 px-2">
            
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Use Cases</p>
                
                <div class="ml-5">
                  
                    <a href="/clickstream"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Clickstream Analytics</a>
                  
                    <a href="/iot"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">IoT Mirroring</a>
                  
                    <a href="/stateful-streaming"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Stateful Streaming</a>
                  </div>
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Documentation</p> 
              <a href="/docs"
                class="block rounded-md ml-5 px-3 py-2 text-blue-700 hover:bg-gray-50">Docs</a>
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Blog Articles</p> 
              <a href="/blog"
                class="block rounded-md ml-5 px-3 py-2 text-blue-700 hover:bg-gray-50">Blog</a>
            
              <p class="block px-3 pt-3 text-md font-medium text-gray-700">Resources</p>
                
                <div class="ml-5">
                  
                    <a href="/about"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">About</a>
                  
                    <a href="/careers"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Careers</a>
                  
                    <a href="/press-releases"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Press</a>
                  
                    <a href="/resources"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Articles</a>
                  
                    <a href="/webinars"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Webinars</a>
                  
                    <a href="https://www.youtube.com/@infinyon/videos"
                      class="block rounded-md px-3 py-2 text-blue-700 hover:bg-gray-50">Videos</a>
                  </div></div>
    </div>
  </div>
</div>
</div>

      </header>
<main>
  <div class="flex flex-1 items-start overflow-hidden max-w-7xl mx-auto py-6">
  <main class="flex-1 overflow-y-auto">
    <section aria-labelledby="primary-heading" class="flex min-w-0 flex-1 flex-col">
      <div class="mx-5">
        <div class="mb-6">
          <nav class="flex" aria-label="Breadcrumb">

  <ol role="list" class="flex items-center space-x-1">
    <li>
      <svg class="h-5 w-5 flex-shrink-0 text-magenta-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M18.75 19.5l-7.5-7.5 7.5-7.5m-6 15L5.25 12l7.5-7.5" />
      </svg>
    </li>
    <li>
      <a href="/blog" class="text-base text-magenta-200 hover:underline">Blog</a>
    </li>
  </ol>
  <div class="grow"></div>

  <div class="flex flex-row mr-5 items-end text-gray-500">
    <div class="flex items-center text-base  hidden sm:inline-flex whitespace-nowrap">
      <svg class="mr-1.5 h-5 x-5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>      
      Read Time: 12 minutes
    </div>
    <div class="flex items-center text-base ml-4">
      <svg class="mr-1.5 h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
      </svg>
      April 02, 2021
    </div>
  </div>

</nav></div>
        <div class="mb-6">
          <h1 class="text-2xl md:text-3xl font-semibold font-md tracking-tight tracking-wide leading-tight bg-gradient-to-r from-magenta-800 to-magenta-300 inline-block text-transparent bg-clip-text">
  Sending tuples from Node to Rust and back
</h1></div>
        <div class="w-full lg:block hidden">
          <img class="mx-auto aspect-[19/10] rounded-lg lg:h-80" src="/blog/images/batch-producer/rust-node-blog-tile.png" alt="Sending tuples from Node to Rust and back">
        </div>
        <div class="block lg:hidden mt-4">
          <div class="flex flex-row">
            <div class="ml-4">
              <div class="flex flex-col">
  <img src="https://avatars.githubusercontent.com/nicholastmosher" alt="Nick Mosher" class="h-16 w-16 rounded-full bg-gray-100">
  <div class="text-base leading-6 pt-2">
    <p class="font-semibold text-gray-900">
      <a href="https://github.com/nicholastmosher">
        Nick Mosher
      </a>
    </p>
    <p class="text-sm text-gray-600">
      Engineer, InfinyOn
    </p>
  </div>
</div>
</div>
            <div class="grow"></div>
            <div class="flex flex-col mr-4 sm:mr-10">
              <h5 class="text-base text-gray-500">SHARE ON</h5>
              <div class="mt-1 pt-2">
                <div class="flex flex-row">
  <div class="pr-2 hover:brightness-75">
    <a class="twitter" title="Share on Twitter"
        href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&text=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back"
        target="_blank">
        <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#00aced"></circle>
  <path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="button reddit" title="Share on Reddit"
      href="https://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&title=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&text=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#ff4500"></circle>
  <path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="linkedin" title="Share on LinkedIn"
      href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&title=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&summary=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#007fb1"></circle>
  <path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white">
  </path>
</svg></a>
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="ycombinator" title="Share on Y Combinator"
      href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&t=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&text=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <circle cx="128" cy="128" r="125" fill="#FB651E"></circle>
	<path d="M119.373653,144.745813 L75.43296,62.4315733 L95.5144533,62.4315733 L121.36192,114.52416 C121.759575,115.452022 122.2235,116.413008 122.753707,117.407147 C123.283914,118.401285 123.747838,119.428546 124.145493,120.48896 C124.410597,120.886615 124.609422,121.251127 124.741973,121.582507 C124.874525,121.913886 125.007075,122.212123 125.139627,122.477227 C125.802386,123.802744 126.39886,125.095105 126.929067,126.354347 C127.459274,127.613589 127.923198,128.773399 128.320853,129.833813 C129.381268,127.580433 130.541078,125.1614 131.80032,122.57664 C133.059562,119.99188 134.351922,117.307747 135.67744,114.52416 L161.92256,62.4315733 L180.612267,62.4315733 L136.27392,145.739947 L136.27392,198.826667 L119.373653,198.826667 L119.373653,144.745813 Z" fill="white">
  </path>
</svg></a>
  </div>
</div></div>
              <div class="mt-1 pt-2">
                <div class="github">
  <a href="https://gitHub.com/infinyon/fluvio/stargazers/"><img src="https://img.shields.io/github/stars/infinyon/fluvio?style=social" alt="GitHub stars"></a>
</div></div>
            </div>
          </div>
        </div>
        <div class="blog mt-8 lg:max-w-5xl max-w-7xl prose prose-quoteless prose-zing prose-md">
          <p>This week in Fluvio, I want to talk about an interesting problem I encountered
while implementing a Batch Producer API for the Fluvio client. As part of our
feature development process, we update each of our language clients with
new APIs for interacting with the new functionality. This particular problem
cropped up while I was implementing the Node client API for batch record producing,
and has to do with passing Tuples from Node to Rust.</p>
<h2 id="overview">Overview</h2>
<p>In this post, I&rsquo;ll talk you through the problem solving journey I went on this week, by:</p>
<ul>
<li>Describing the Rust API I wanted to call from Node</li>
<li>Discovering why the Node API didn&rsquo;t work out-of-the-box, and</li>
<li>Explaining how I solved the problem with a patch to <code>node-bindgen</code></li>
</ul>
<h2 id="send-all-api">Send-All API</h2>
<p>In our batch producer API, the goal is to send multiple records to Fluvio in one
request. Records are represented as a value and potentially a key. I chose to
expose this functionality with a function that accepts any iterator over items
of type <code>(Option&lt;K&gt;, V)</code>. The elements of this tuple represent the potential key
and the definite value. The specific function I wanted to write in Rust and call
from Node is the following:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">send_all</span><span class="o">&lt;</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">records</span>: <span class="nc">I</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">K</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">V</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>To be as flexible as possible, we&rsquo;re using a couple of generics so that callers
have more freedom with the values they can pass to us. An english description of
this API might go something like this:</p>
<blockquote>
<p>Provide a value <code>records</code> which can be turned into an iterator over tuples
<code>(Option&lt;K&gt;, V)</code>, where K and V are each types that can be converted into
byte buffers.</p>
</blockquote>
<p>Here are some quick examples of values you could provide to this API:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;World!&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x65</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6f</span><span class="p">]),</span><span class="w"> </span><span class="s">&#34;World!&#34;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashSet</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">r</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">),</span><span class="w"> </span><span class="s">&#34;World!&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><p>Now let&rsquo;s think about what we want out of a Node API. In Javascript, we don&rsquo;t really
abstract over different types of iterators often enough for it to be relevant, so we
can settle with passing a plain array. What about the elements of our array though?
Javascript doesn&rsquo;t technically have tuples, but a common pattern to use instead is
simply choosing a fixed-size array and putting all of their values into it. In fact,
typescript even supports annotating this situation! Let&rsquo;s take a look at how this
plays out:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">KeyValue</span> <span class="o">=</span> <span class="p">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">TopicProducer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sendAll</span><span class="p">(</span><span class="nx">records</span>: <span class="kt">KeyValue</span><span class="p">[])</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>I created the type alias <code>KeyValue</code> to represent our tuple type, where each item in
the tuple is a <code>string</code>. Our function <code>sendAll</code> wants us to give it an array of these
tuples.</p>
<p>Alright, so now we&rsquo;ve got a handle of the underlying Rust API that we want to bind
to, and we know what we want our Node API to look like as well. Let&rsquo;s take a look at
how to glue them together using <a href="https://github.com/infinyon/node-bindgen/">node-bindgen</a>.</p>
<h3 id="node-bindgen">Node-bindgen</h3>
<p>Node-bindgen is a Rust crate for automatically generating glue code for Node programs
that want to interact with Rust functions and types. It works by providing an attribute,
<code>#[node_bindgen]</code>, that can be applied to functions and implementation blocks. At
compile-time, node-bindgen generates conversion code for Node and Rust code to
pass values back and forth, leveraging Node&rsquo;s N-API. An example node-bindgen function
might look like this:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">node_bindgen</span>::<span class="n">derive</span>::<span class="n">node_bindgen</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[node_bindgen]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">sum_all</span><span class="p">(</span><span class="n">ints</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ints</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>The way this works is via a pair of traits for converting values to and from the
Node representation. We have <code>trait JSValue&lt;'_&gt;</code>, which describes how to convert
a JS value into a Rust value, and we have <code>trait TryIntoJs</code>, which does the opposite.
This is nice because it allows us to define conversions for new types, as well as
to define conversions for <em>compound</em> types, built from other convertible types.</p>
<p>We&rsquo;ve already seen an example of a compound data type, <code>Vec&lt;i32&gt;</code>! Vec has a blanket
implementation of <code>JSValue</code> for any other type <code>T</code> as long as <code>T</code> also implements
<code>JSValue</code>. Great! So in principle, as long as we&rsquo;re just combining basic types, everything
should be fine and dandy, right? Let&rsquo;s try it out with the API we want:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[node_bindgen]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">send_all</span><span class="p">(</span><span class="n">records</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// todo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>When I compiled it, I was met with this error message:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cargo build
</span></span><span class="line"><span class="cl">error<span class="o">[</span>E0277<span class="o">]</span>: the trait bound <span class="sb">`</span><span class="o">(</span>String, String<span class="o">)</span>: JSValue&lt;<span class="s1">&#39;_&gt;` is not satisfied
</span></span></span><span class="line"><span class="cl"><span class="s1"> --&gt; tuples/src/lib.rs:3:1
</span></span></span><span class="line"><span class="cl"><span class="s1">  |
</span></span></span><span class="line"><span class="cl"><span class="s1">3 | #[node_bindgen]
</span></span></span><span class="line"><span class="cl"><span class="s1">  | ^^^^^^^^^^^^^^^ the trait `JSValue&lt;&#39;</span>_&gt;<span class="sb">`</span> is not implemented <span class="k">for</span> <span class="sb">`</span><span class="o">(</span>String, String<span class="o">)</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="o">=</span> note: required because of the requirements on the impl of <span class="sb">`</span>JSValue&lt;<span class="s1">&#39;_&gt;` for `Vec&lt;(String, String)&gt;`
</span></span></span><span class="line"><span class="cl"><span class="s1">  = note: required because of the requirements on the impl of `ExtractArgFromJs&lt;&#39;</span>_&gt;<span class="sb">`</span> <span class="k">for</span> <span class="sb">`</span>Vec&lt;<span class="o">(</span>String, String<span class="o">)</span>&gt;<span class="sb">`</span>
</span></span><span class="line"><span class="cl">  <span class="o">=</span> note: this error originates in an attribute macro <span class="o">(</span>in Nightly builds, run with -Z macro-backtrace <span class="k">for</span> more info<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">error: aborting due to previous error
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">For more information about this error, try <span class="sb">`</span>rustc --explain E0277<span class="sb">`</span>.
</span></span><span class="line"><span class="cl">error: could not compile <span class="sb">`</span>nj-example-tuple<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To learn more, run the <span class="nb">command</span> again with --verbose.
</span></span></code></pre></div><p>Ok, well I didn&rsquo;t <em>actually</em> think this was going to be easy, did I?
From the looks of it, <code>node-bindgen</code> is missing implementations of <code>JSValue</code> for tuple types!
But this is actually kind of cool, now I have a chance to make an improvement to
<code>node-bindgen</code> that will be useful to other users even outside of Fluvio.</p>
<h3 id="implementing-jsvalue-for-a-b-">Implementing <code>JSValue</code> for <code>(A, B, ...)</code></h3>
<p>So now I know that I&rsquo;ll need to write some new <code>JSValue</code> implementations. We will need
a special implementation for each size of tuple that we want to support. Right away, it
smells like a perfect recipe for a macro! But before diving straight into writing macros,
I wanted to first try out this strategy with just one case and make sure it works.</p>
<p>For the first go-round, I&rsquo;ll write an implementation for 2-Tuples. This implementation will
need to be generic over the two component pieces, and it will require that both pieces also
implement <code>JSValue</code>. Our impl block will look like this:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">A</span>: <span class="nc">JsValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">B</span>: <span class="nc">JsValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">convert_to_rust</span><span class="p">(</span><span class="n">env</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="nc">JsEnv</span><span class="p">,</span><span class="w"> </span><span class="n">js_value</span>: <span class="nc">napi_value</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">NjError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// TODO
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Alright, so far so good, but how to we implement <code>convert_to_rust</code>? Well <code>JsEnv</code> is a type
that represents the environment surrounding the value that we are attempting to convert to
Rust. Contained somewhere within it are all the values that were in scope when the Node
program called into our Rust function. We also have <code>js_value</code>, which I think of as a
handle to the specific value that we want to retrieve from the environment.</p>
<p>So let&rsquo;s take a step back for a moment and think about the values that we&rsquo;ll actually be
dealing with. In Node, a tuple is just a list of values. And we already have a way of
receiving lists from Node, it&rsquo;s the <code>impl&lt;T&gt; JSValue&lt;'_&gt; for Vec&lt;T&gt;</code>! Let&rsquo;s take a look at
how that works:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span>: <span class="nc">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">convert_to_rust</span><span class="p">(</span><span class="n">env</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="nc">JsEnv</span><span class="p">,</span><span class="w"> </span><span class="n">js_value</span>: <span class="nc">napi_value</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">NjError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">sys</span>::<span class="n">napi_get_array_length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">env</span><span class="p">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">js_value</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="s">&#34;not array&#34;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">length</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">napi_call_result!</span><span class="p">(</span><span class="n">napi_get_array_length</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">inner</span><span class="p">(),</span><span class="w"> </span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">length</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">length</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">js_element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">elements</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">T</span>::<span class="n">convert_to_rust</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">js_element</span><span class="p">)</span><span class="o">?</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Alright, so it looks like what&rsquo;s happening is:</p>
<ul>
<li>
<p>First, we check with the <code>JsEnv</code> that the value given to us was actually an array.
I think of this as the moral equivalent in JS of using <code>Array.isArray(js_value)</code>.</p>
</li>
<li>
<p>Then, we ask the environment to give us the length of the array that was passed to us.</p>
</li>
<li>
<p>Finally, we loop over all the slots in the JS array and ask the environment for the
object handle of the value at that position in the array. Then, since we are expecting
all of those values to have the same type <code>T</code>, we use <code>T</code>&rsquo;s own implementation of
<code>convert_to_rust</code> to convert the element of the array and put it into our Vec.</p>
</li>
</ul>
<p>Ok, awesome. I think there is a lot of information here that we can re-purpose for
what we need to do for tuples. Here&rsquo;s the plan for things we&rsquo;ll do the same and things
we&rsquo;ll change about this process:</p>
<ul>
<li>
<p>Since we know that JS &ldquo;tuples&rdquo; are arrays, we&rsquo;ll use the same techniques to check
that our value is an array and to get values out of it.</p>
</li>
<li>
<p>We know that tuples have a fixed length, so we&rsquo;ll check that the length of the array
that is passed to us matches the number of elements in the tuple we are expecting. For
our initial implementation with <code>(A, B)</code>, we&rsquo;ll make sure the array has length 2.</p>
</li>
<li>
<p>When we convert the array elements to Rust, instead of using just a single type
<code>T</code> for all the elements like Vec did, we&rsquo;ll use <code>A</code> and <code>B</code>&rsquo;s implementations of
<code>convert_to_rust</code> for the corresponding elements of the array.</p>
</li>
</ul>
<p>Alright, let&rsquo;s see if we can execute on this plan:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="n">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">A</span>: <span class="nc">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">B</span>: <span class="nc">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">convert_to_rust</span><span class="p">(</span><span class="n">env</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="nc">JsEnv</span><span class="p">,</span><span class="w"> </span><span class="n">js_value</span>: <span class="nc">napi_value</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">NjError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">sys</span>::<span class="n">napi_get_array_length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">env</span><span class="p">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">js_value</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="s">&#34;not array&#34;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// Since this tuple has 2 elements
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">length</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">napi_call_result!</span><span class="p">(</span><span class="n">napi_get_array_length</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">inner</span><span class="p">(),</span><span class="w"> </span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">length</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;Expected array of length </span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">required_length</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">napi_value_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span>::<span class="n">convert_to_rust</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">napi_value_a</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">napi_value_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span>::<span class="n">convert_to_rust</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">napi_value_b</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Ok, let&rsquo;s try it out with the <code>send_all</code> function and see if it worked!</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cargo build
</span></span><span class="line"><span class="cl">   Compiling nj-core v4.2.0 <span class="o">(</span>/Users/nick/infinyon/node-bindgen/nj-core<span class="o">)</span>
</span></span><span class="line"><span class="cl">   Compiling node-bindgen v4.3.0 <span class="o">(</span>/Users/nick/infinyon/node-bindgen<span class="o">)</span>
</span></span><span class="line"><span class="cl">   Compiling nj-example-tuple v0.1.0 <span class="o">(</span>/Users/nick/infinyon/node-bindgen/examples/tuples<span class="o">)</span>
</span></span><span class="line"><span class="cl">warning: unused variable: <span class="sb">`</span>records<span class="sb">`</span>
</span></span><span class="line"><span class="cl"> --&gt; tuples/src/lib.rs:4:19
</span></span><span class="line"><span class="cl">  <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">4</span> <span class="p">|</span> async fn send_all<span class="o">(</span>records: Vec&lt;<span class="o">(</span>String, String<span class="o">)</span>&gt;<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>                   ^^^^^^^ help: <span class="k">if</span> this is intentional, prefix it with an underscore: <span class="sb">`</span>_records<span class="sb">`</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="o">=</span> note: <span class="sb">`</span><span class="c1">#[warn(unused_variables)]` on by default</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">warning: <span class="m">1</span> warning emitted
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Finished dev <span class="o">[</span>unoptimized + debuginfo<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> in 4.05s
</span></span></code></pre></div><p>Woohoo! We&rsquo;ve got it compiling. Let&rsquo;s write a quick body that just prints everything
it receives so that we can just check that everything Really Actually Works.</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[node_bindgen]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">send_all</span><span class="p">(</span><span class="n">records</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Got Key=</span><span class="si">{}</span><span class="s">, Value=</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>We&rsquo;ll call it from a typescript module like this:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">addon</span>: <span class="kt">TestTuples</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;./dist&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">KeyValue</span> <span class="o">=</span> <span class="p">[</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">TestTuples</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sendAll</span><span class="p">(</span><span class="nx">records</span>: <span class="kt">KeyValue</span><span class="p">[])</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">void</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">records</span>: <span class="kt">KeyValue</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&#34;Apple&#34;</span><span class="p">,</span> <span class="s2">&#34;Banana&#34;</span><span class="p">]</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">addon</span><span class="p">.</span><span class="nx">sendAll</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span>
</span></span></code></pre></div><p>And the moment of truth:</p>
<div class="copy-first-line"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npx ts-node ./test.ts
</span></span><span class="line"><span class="cl">Got <span class="nv">Key</span><span class="o">=</span>Apple, <span class="nv">Value</span><span class="o">=</span>Banana
</span></span></code></pre></div><p>Great! We can now pass tuples from Node to Rust, and everything gets converted as expected!
I won&rsquo;t write it all out here, but I did test with other permutations of types, array lengths, etc.,
and everything works pretty much how you&rsquo;d expect it to. If you want to see a bit more of an example,
check out the new <a href="https://github.com/infinyon/node-bindgen/tree/master/examples/tuples">node-bindgen example for tuples</a> :)</p>
<h3 id="bonus-writing-a-macro-to-implement-more-tuples">Bonus: Writing a macro to implement more tuples</h3>
<p>Alright, so we&rsquo;ve written enough to fit our use-case, but we can&rsquo;t stop there!
We want to be able to pass other sizes of tuples between Rust and Node. However,
we don&rsquo;t want to have to hand-write the implementations for each size of tuple, so
let&rsquo;s see if we can make a macro do the job for us!</p>
<p>What we want is a macro that looks something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">impl_js_value_for_tuple!</span><span class="p">(</span><span class="n">A</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">impl_js_value_for_tuple!</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">impl_js_value_for_tuple!</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>Ok, so let&rsquo;s give this a shot:</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">impl_js_value_for_tuple_first_attempt</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="cp">$t</span>:<span class="nc">ident</span><span class="w"> </span><span class="p">),</span><span class="o">+</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$t</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">crate</span>::<span class="n">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="cp">$($t</span><span class="p">,)</span><span class="o">+</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="cp">$($t</span>: <span class="nc">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="p">,)</span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">fn</span> <span class="nf">convert_to_rust</span><span class="p">(</span><span class="n">env</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="nc">JsEnv</span><span class="p">,</span><span class="w"> </span><span class="n">js_value</span>: <span class="nc">napi_value</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">NjError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">sys</span>::<span class="n">napi_get_array_length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">env</span><span class="p">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">js_value</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="s">&#34;Tuples must come from JS arrays&#34;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">length</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="fm">napi_call_result!</span><span class="p">(</span><span class="n">napi_get_array_length</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">inner</span><span class="p">(),</span><span class="w"> </span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">length</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{n}</span><span class="s">Tuple must have exactly length </span><span class="si">{n}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">required_length</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cp">$(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">js_element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="o">???</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="cp">#[allow(non_snake_case)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="cp">$t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">$t</span>::<span class="n">convert_to_rust</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">js_element</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">)</span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nb">Ok</span><span class="p">((</span><span class="w"> </span><span class="cp">$($t</span><span class="p">,)</span><span class="o">+</span><span class="w"> </span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>So this comes pretty close, but there are a couple problems. Firstly, we want each
tuple implementation to check that the provided Node array has the same length as the
tuple type we are dealing with, but this form of macro doesn&rsquo;t provide any amenities
for counting the size of the type, or for selecting individual elements from the array
by index. There are some tricks that we <em>might</em> be able to leverage from the
<a href="https://danielkeep.github.io/tlborm/book/index.html">little book of macros</a>, but that seems like it would make things much more complicated
than I want to deal with.</p>
<p>Well, let&rsquo;s look for inspiration. I know I&rsquo;ve seen libraries use this pattern of implementing
traits for compound types, where the component types implement the traits. Let&rsquo;s take a look
at <code>serde</code> and see how that handles tuples.</p>
<p>Aha! It looks like serde does <a href="https://github.com/serde-rs/serde/blob/master/serde/src/ser/impls.rs#L306-L346">almost the exact same thing</a> I tried to do, it just does it
in a way that is straightforward and actually works! The serde <code>tuple_impls</code> macro takes
a <code>$len</code> expression with the number of elements in the tuple, identifiers for the generic
parameter, <em>and</em> tokens <code>$n:tt</code> indicating the indices of each item in the tuple.</p>
<p>Let&rsquo;s see if we can leverage this pattern to do what we want.</p>
<div class="copy-code"></div>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">impl_js_value_for_tuple</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="cp">$len</span>:<span class="nc">expr</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="cp">$n</span>:<span class="nc">tt</span><span class="w"> </span><span class="cp">$t</span>:<span class="nc">ident</span><span class="w"> </span><span class="p">),</span><span class="o">+</span><span class="w"> </span><span class="cp">$(,</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">))</span><span class="o">+</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cp">$(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="w"> </span><span class="cp">$(,</span><span class="w"> </span><span class="cp">$t</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">crate</span>::<span class="n">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="cp">$($t</span><span class="p">,)</span><span class="o">+</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="cp">$($t</span>: <span class="nc">JSValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="p">,)</span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">fn</span> <span class="nf">convert_to_rust</span><span class="p">(</span><span class="n">env</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span> <span class="nc">JsEnv</span><span class="p">,</span><span class="w"> </span><span class="n">js_value</span>: <span class="nc">napi_value</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">NjError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">sys</span>::<span class="n">napi_get_array_length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">env</span><span class="p">.</span><span class="n">is_array</span><span class="p">(</span><span class="n">js_value</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="s">&#34;Tuples must come from JS arrays&#34;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">length</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="fm">napi_call_result!</span><span class="p">(</span><span class="n">napi_get_array_length</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">inner</span><span class="p">(),</span><span class="w"> </span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">length</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">$len</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">required_length</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">NjError</span>::<span class="n">Other</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{n}</span><span class="s">Tuple must have exactly length </span><span class="si">{n}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">required_length</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="cp">$(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="kd">let</span><span class="w"> </span><span class="n">js_element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">js_value</span><span class="p">,</span><span class="w"> </span><span class="cp">$n</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="cp">#[allow(non_snake_case)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="kd">let</span><span class="w"> </span><span class="cp">$t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">$t</span>::<span class="n">convert_to_rust</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">js_element</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">)</span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nb">Ok</span><span class="p">((</span><span class="w"> </span><span class="cp">$($t</span><span class="p">,)</span><span class="o">+</span><span class="w"> </span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">impl_js_value_for_tuple!</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">T4</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">6</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">T4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">T5</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">7</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">T4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">T5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">T6</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">T4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">T5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">T6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">T7</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">T3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">T4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">T5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">T6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">T7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">T8</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Bingo! We now have working implementations for converting tuple types from Node
to Rust. This pattern also works out in the opposite direction, and I was able
to write a macro to <a href="https://github.com/infinyon/node-bindgen/blob/master/nj-core/src/convert.rs#L327-L362">impl TryIntoJs for tuples</a> as well! Mission accomplished,
we can now pass values both ways in tuples.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Thanks for reading this far! I hope you enjoyed my little foray into
the world of Rust/Node glue code with node-bindgen, I know I had a lot of fun
working with the blanket impls and tuple macros, it gives me the warm fuzzy feeling
of writing slick composable code 😎.</p>
<p>If you&rsquo;d like to learn more about the work we do on Fluvio or node-bindgen,
be sure to check out <a href="https://fluvio.io">our website at fluvio.io</a> and our <a href="https://github.com/infinyon/fluvio">Github repo</a>. If you have
any questions or want to learn more about Fluvio, you can come talk to us on our
<a href="https://discordapp.com/invite/bBG2dTz">Discord server</a>. Until next time!</p>
<h4 id="quick-links">Quick links:</h4>
<ul>
<li><a href="https://www.fluvio.io/docs/get-started/mac/">Getting started with Fluvio</a></li>
<li><a href="https://www.fluvio.io/cli/">Fluvio CLI reference</a></li>
<li><a href="https://www.fluvio.io/docs/architecture/overview/">Fluvio Architecture</a></li>
</ul>

        </div>      
      </div>

    </section>
  </main> 

  <aside class="hidden mx-5 w-72 overflow-y-auto lg:block py-6">
  <article class="flex flex-col items-start px-4">

    <h2 class="text-sm text-gray-500 tracking-widest">
      SHARE ON
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-4 w-5/6" />
    <div class="w-full mx-auto pb-4">
      <div class="flex flex-row">
  <div class="pr-2 hover:brightness-75">
    <a class="twitter" title="Share on Twitter"
        href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&text=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back"
        target="_blank">
        <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#00aced"></circle>
  <path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="button reddit" title="Share on Reddit"
      href="https://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&title=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&text=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#ff4500"></circle>
  <path d="m 52.8165,31.942362 c 0,-2.4803 -2.0264,-4.4965 -4.5169,-4.4965 -1.2155,0 -2.3171,0.4862 -3.128,1.2682 -3.077,-2.0247 -7.2403,-3.3133 -11.8507,-3.4782 l 2.5211,-7.9373 6.8272,1.5997 -0.0102,0.0986 c 0,2.0281 1.6575,3.6771 3.6958,3.6771 2.0366,0 3.6924,-1.649 3.6924,-3.6771 0,-2.0281 -1.6575,-3.6788 -3.6924,-3.6788 -1.564,0 -2.8968,0.9758 -3.4357,2.3443 l -7.3593,-1.7255 c -0.3213,-0.0782 -0.6477,0.1071 -0.748,0.4233 L 32,25.212062 c -4.8246,0.0578 -9.1953,1.3566 -12.41,3.4425 -0.8058,-0.7446 -1.8751,-1.2104 -3.0583,-1.2104 -2.4905,0 -4.5152,2.0179 -4.5152,4.4982 0,1.649 0.9061,3.0787 2.2389,3.8607 -0.0884,0.4794 -0.1462,0.9639 -0.1462,1.4569 0,6.6487 8.1736,12.0581 18.2223,12.0581 10.0487,0 18.224,-5.4094 18.224,-12.0581 0,-0.4658 -0.0493,-0.9248 -0.1275,-1.377 1.4144,-0.7599 2.3885,-2.2304 2.3885,-3.9406 z m -29.2808,3.0872 c 0,-1.4756 1.207,-2.6775 2.6894,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 -1.4824,0 -2.6894,-1.2002 -2.6894,-2.6758 z m 15.4037,7.9373 c -1.3549,1.3481 -3.4816,2.0043 -6.5008,2.0043 l -0.0221,-0.0051 -0.0221,0.0051 c -3.0209,0 -5.1476,-0.6562 -6.5008,-2.0043 -0.2465,-0.2448 -0.2465,-0.6443 0,-0.8891 0.2465,-0.2465 0.6477,-0.2465 0.8942,0 1.105,1.0999 2.9393,1.6337 5.6066,1.6337 l 0.0221,0.0051 0.0221,-0.0051 c 2.6673,0 4.5016,-0.5355 5.6066,-1.6354 0.2465,-0.2465 0.6477,-0.2448 0.8942,0 0.2465,0.2465 0.2465,0.6443 0,0.8908 z m -0.3213,-5.2615 c -1.4824,0 -2.6877,-1.2002 -2.6877,-2.6758 0,-1.4756 1.2053,-2.6775 2.6877,-2.6775 1.4824,0 2.6877,1.2019 2.6877,2.6775 0,1.4756 -1.2053,2.6758 -2.6877,2.6758 z" fill="white">
  </path>
</svg></a>    
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="linkedin" title="Share on LinkedIn"
      href="https://www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&title=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&summary=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <circle cx="32" cy="32" r="31" fill="#007fb1"></circle>
  <path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white">
  </path>
</svg></a>
  </div>
  <div class="pr-2 hover:brightness-75">
    <a class="ycombinator" title="Share on Y Combinator"
      href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1315%2fblog%2f2021%2f04%2fnode-bindgen-tuples&t=Sending%20tuples%20from%20Node%20to%20Rust%20and%20back&text=How%20I%20added%20tuple%20support%20to%20node-bindgen."
      target="_blank">
      <svg class="w-9 h-9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
  <circle cx="128" cy="128" r="125" fill="#FB651E"></circle>
	<path d="M119.373653,144.745813 L75.43296,62.4315733 L95.5144533,62.4315733 L121.36192,114.52416 C121.759575,115.452022 122.2235,116.413008 122.753707,117.407147 C123.283914,118.401285 123.747838,119.428546 124.145493,120.48896 C124.410597,120.886615 124.609422,121.251127 124.741973,121.582507 C124.874525,121.913886 125.007075,122.212123 125.139627,122.477227 C125.802386,123.802744 126.39886,125.095105 126.929067,126.354347 C127.459274,127.613589 127.923198,128.773399 128.320853,129.833813 C129.381268,127.580433 130.541078,125.1614 131.80032,122.57664 C133.059562,119.99188 134.351922,117.307747 135.67744,114.52416 L161.92256,62.4315733 L180.612267,62.4315733 L136.27392,145.739947 L136.27392,198.826667 L119.373653,198.826667 L119.373653,144.745813 Z" fill="white">
  </path>
</svg></a>
  </div>
</div></div>

    <h2 class="mt-4 text-sm text-gray-500 tracking-widest">
      AUTHOR
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-4 w-5/6" />

    <div class="w-full mx-auto flex flex-col items-start">
      <div class="flex flex-col">
  <img src="https://avatars.githubusercontent.com/nicholastmosher" alt="Nick Mosher" class="h-16 w-16 rounded-full bg-gray-100">
  <div class="text-base leading-6 pt-2">
    <p class="font-semibold text-gray-900">
      <a href="https://github.com/nicholastmosher">
        Nick Mosher
      </a>
    </p>
    <p class="text-sm text-gray-600">
      Engineer, InfinyOn
    </p>
  </div>
</div>
</div>

    <h2 class="mt-8 text-sm text-gray-500 tracking-widest">
      FLUVIO OSS
    </h2>
    <hr class="border-b-0 border-gray-200 w-full mt-3 pb-6 w-5/6" />
    <div class="github">
  <a href="https://gitHub.com/infinyon/fluvio/stargazers/"><img src="https://img.shields.io/github/stars/infinyon/fluvio?style=social" alt="GitHub stars"></a>
</div>
<h2 class="mt-12 text-sm text-gray-500 tracking-widest">
  INFINYON CLOUD
</h2>
<hr class="border-b-0 border-gray-200 w-full mt-3 pb-3" />
<div class="mt-2 py-5 w-full rounded-md bg-gradient-to-r from-magenta-800 to-magenta-400">
  <a href="https://infinyon.cloud/signup">
  <h3 class="text-base font-semibold text-pink-400 text-center">
    Accelerated Onboarding
  </h3>
  <div class="pt-1 flex flex-row">
    <div class="flex flex-col w-4/6 justify-center">
      <h5 class="text-xs text-gray-100 pl-3">
         Sign-up for personalized assistance from dedicated InfinyOn architect.
      </h5>
    </div>
    <div class="flex flex-col mt-2 mr-2 h-20 w-20 rounded-md bg-black items-center justify-center">
      <h5 class="text-base leading-5 font-bold text-neon-300 w-16 break-words text-center">
        Free $3000
      </h5>
        <h6 class="text-xxs text-gray-100 pt-1">
          2000 credits
        </h6>
    </div>
  </div>
  </a>
</div></article>
</aside></div>

<script src="/js/copy-code.js"></script></main>
    </div>
    <footer class="bg-gray-900" aria-labelledby="footer-heading">
  <h2 id="footer-heading" class="sr-only">Footer</h2>

  <div class="mx-auto max-w-7xl px-6 pb-16 pt-16 lg:px-8">
    <div class="lg:grid lg:grid-cols-10 lg:gap-8">

      
      <div class="lg:col-span-2 space-y-6">
        <img class="h-7 w-auto" src="/assets/infinyon-logo-text-white.svg" alt="InfinyOn">
        <p class="text-sm leading-6 text-gray-300"></p>
        <div class="flex space-x-6">
            <a href="https://github.com/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">GitHub</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path fill-rule="evenodd"
        d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
        clip-rule="evenodd" />
</svg>
            </a>
            <a href="https://twitter.com/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">Twitter</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path
        d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
</svg>
            </a>
            <a href="https://linkedin.com/company/infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">linkedin</span>
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" aria-hidden="true" viewBox="0 0 448 512">
  <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/>
</svg>
            </a>
            <a href="https://discordapp.com/invite/bBG2dTz" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">discord</span>
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" aria-hidden="true"
    viewBox="0 0 640 512">
    <path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z" />
</svg>
            </a>
            <a href="https://www.youtube.com/@infinyon" class="text-gray-300 hover:text-gray-100" target="_blank"><span class="sr-only">YouTube</span>
<svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
    <path fill-rule="evenodd"
        d="M19.812 5.418c.861.23 1.538.907 1.768 1.768C21.998 8.746 22 12 22 12s0 3.255-.418 4.814a2.504 2.504 0 0 1-1.768 1.768c-1.56.419-7.814.419-7.814.419s-6.255 0-7.814-.419a2.505 2.505 0 0 1-1.768-1.768C2 15.255 2 12 2 12s0-3.255.417-4.814a2.507 2.507 0 0 1 1.768-1.768C5.744 5 11.998 5 11.998 5s6.255 0 7.814.418ZM15.194 12 10 15V9l5.194 3Z"
        clip-rule="evenodd" />
</svg>
            </a>
        </div>
      </div>

      
      <div class="lg:col-span-8">
        <div class="mt-16 lg:mt-0 grid grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-12">
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Cloud</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/infinyon-cloud" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Cloud
                </a>
                </li>
                <li>
                  <a href="https://infinyon.cloud/signup" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Sign Up
                </a>
                </li>
                <li>
                  <a href="https://infinyon.cloud/login" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Login
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Product</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Platform
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    InfinyOn Hub
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Connectors
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Webhooks
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    SmartModules
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Event Streams
                </a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Stateful Streams
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">Solutions</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/iot" class="text-sm leading-6 text-gray-300 hover:text-white">
                    IoT Aggregation
                </a>
                </li>
                <li>
                  <a href="/clickstream" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Website Monitoring
                </a>
                </li>
                <li>
                  <a href="/" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Microservices Event Bridge
                </a>
                </li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold leading-4 text-white">About</h3>
            <ul role="list" class="mt-6 space-y-2">
                <li>
                  <a href="/about" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Company
                </a>
                </li>
                <li>
                  <a href="/careers" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Careers
                </a>
                </li>
                <li>
                  <a href="/resources" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Articles
                </a>
                </li>
                <li>
                  <a href="/press-releases" class="text-sm leading-6 text-gray-300 hover:text-white">
                    News
                </a>
                </li>
                <li>
                  <a href="/webinars" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Webinars
                </a>
                </li>
                <li>
                  <a href="https://www.youtube.com/@infinyon/videos" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Videos
                </a>
                </li>
                <li>
                  <a href="/blog" class="text-sm leading-6 text-gray-300 hover:text-white">
                    Blog
                </a>
                </li>
            </ul>
          </div>
          
        </div>
      </div>

    </div>

    
    <div class="mt-8 border-t border-white/10 pt-4 text-center">
      <div class="text-center text-xs text-gray-400">
        
        <span><a href="/legal/privacy">Privacy Policy</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/security">Security</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/user-agreement">Terms and Conditions</a></span>
           
          <span class="px-1">|</span> <span><a href="/legal/cookies">Cookie Notice</a></span>
          
      </div>
      <p class="text-xs leading-5 text-gray-400">&copy; <span id="year"></span> InfinyOn, Inc. All rights reserved.</p>
      <script>
        document.getElementById("year").innerHTML = new Date().getFullYear();
      </script>
    </div>
  </div>
</footer>
    
  </body>
</html>